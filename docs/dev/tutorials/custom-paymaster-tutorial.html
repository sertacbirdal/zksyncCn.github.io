<!DOCTYPE html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://era.zksync.io/docs/dev/tutorials/custom-paymaster-tutorial.html"><meta property="og:site_name" content="Welcome to our Docs | zkSync Era"><meta property="og:title" content="构建自定义的paymaster"><meta property="og:description" content="让我们看看如何使用paymaster功能来建立一个自定义的paymaster，让用户在我们的token中支付费用。在本教程中，我们将。创建一个paymaster，它将假设一个单位的ERC20代币足以支付任何交易费用。; 创建ERC20代币合约并发送一些代币到一个全新的钱包。; 最后我们将从新创建的钱包通过paymaster发送一个mint交易。尽..."><meta property="og:type" content="article"><meta property="og:updated_time" content="2023-03-08T13:49:58.000Z"><meta property="og:locale" content="en-US"><meta property="article:modified_time" content="2023-03-08T13:49:58.000Z"><link rel="canonical" href="https://era.zksync.io/docs/"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap"><meta name="keywords" content="Documentation, Developers, Era, zkSync, Matter Labs, rollup, ZK rollup, zero confirmation, ZKP, zero-knowledge proofs, Ethereum, crypto, blockchain, permissionless, L2, secure payments, scalable"><meta name="description" content="zkSync Era is a user-centric zk rollup platform from Matter Labs. It is a scaling solution for Ethereum, already live on Ethereum mainnet"><meta name="author" content="https://matter-labs.io"><meta name="og:image" content="/docs/share_image.png"><meta name="og:image:secure_url" content="/docs/share_image.png"><meta name="og:url" content="https://era.zksync.io/docs/"><meta name="og:image:alt" content="zkSync — Accelerating the mass adoption of crypto for personal sovereignty"><meta name="og:title" content="Welcome to our Docs | zkSync Era"><meta name="og:description" content="zkSync Era is a user-centric zk rollup platform from Matter Labs. It is a scaling solution for Ethereum, already live on Ethereum mainnet."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Welcome to our Docs | zkSync Era"><meta name="twitter:description" content="zkSync Era is a user-centric zk rollup platform from Matter Labs. It is a scaling solution for Ethereum, already live on Ethereum mainnet."><meta name="twitter:image" content="/docs/share_image.png"><meta name="twitter:site" content="@zksync"><meta name="twitter:creator" content="@the_matter_labs"><meta name="twitter:image:alt" content="zkSync — Accelerating the mass adoption of crypto for personal sovereignty"><link rel="apple-touch-icon" sizes="180x180" href="/docs/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/docs/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/docs/favicon-16x16.png"><link rel="manifest" href="/docs/site.webmanifest"><link rel="mask-icon" href="/docs/safari-pinned-tab.svg" color="#1E69FF"><link rel="shortcut icon" href="/docs/favicon.ico"><meta name="msapplication-TileColor" content="#1E69FF"><meta name="msapplication-config" content="/docs/browserconfig.xml"><meta name="theme-color" content="#1E69FF"><title>构建自定义的paymaster | Welcome to our Docs | zkSync Era</title>
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/docs/assets/style-ff18934e.css" as="style"><link rel="stylesheet" href="/docs/assets/style-ff18934e.css">
    <link rel="modulepreload" href="/docs/assets/app-9b0e9180.js"><link rel="modulepreload" href="/docs/assets/framework-674379d2.js"><link rel="modulepreload" href="/docs/assets/custom-paymaster-tutorial.html-4124341d.js"><link rel="modulepreload" href="/docs/assets/custom-paymaster-tutorial.html-683643f7.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/docs/" class="brand"><img class="logo" src="/docs/zk-sync-era-line-light.svg" alt="Welcome to our Docs | zkSync Era"><!----><span class="site-name hide-in-pad">Welcome to our Docs | zkSync Era</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/docs/" class="nav-link" aria-label="Home"><!---->Home<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/dev/" class="nav-link active" aria-label="开发文档"><!---->开发文档<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/api/" class="nav-link" aria-label="Tools and SDK"><!---->Tools and SDK<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/contact.html" class="nav-link" aria-label="联系方式"><!---->联系方式<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="版本"><span class="title"><!---->版本</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/docs/dev/" class="nav-link active" aria-label="zkSync Era"><!---->zkSync Era<!----></a></li><li class="dropdown-item"><a href="https://docs.zksync.io" rel="noopener noreferrer" target="_blank" aria-label="zkSync Lite" class="nav-link"><!---->zkSync Lite<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/matter-labs/zksync-web-v2-docs" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><div id="docsearch-container"></div><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/docs/dev/" class="nav-link sidebar-link sidebar-page" aria-label="介绍"><!---->介绍<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/docs/dev/fundamentals" class="title">快速开始</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/docs/dev/fundamentals/rollups.html" class="nav-link sidebar-link sidebar-page" aria-label="介绍rollups"><!---->介绍rollups<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/fundamentals/zkSync.html" class="nav-link sidebar-link sidebar-page" aria-label="zkSync Era基础知识"><!---->zkSync Era基础知识<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/fundamentals/interacting.html" class="nav-link sidebar-link sidebar-page" aria-label="与zkSync Era互动"><!---->与zkSync Era互动<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/fundamentals/hyperscaling.html" class="nav-link sidebar-link sidebar-page" aria-label="高扩容性"><!---->高扩容性<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/docs/dev/developer-guides" class="title">理解 zkSync Era</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/docs/dev/developer-guides/transactions/transactions.html" class="nav-link sidebar-link sidebar-page" aria-label="交易"><!---->交易<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/developer-guides/transactions/blocks.html" class="nav-link sidebar-link sidebar-page" aria-label="区块"><!---->区块<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/developer-guides/system-contracts.html" class="nav-link sidebar-link sidebar-page" aria-label="系统合约"><!---->系统合约<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/developer-guides/aa.html" class="nav-link sidebar-link sidebar-page" aria-label="支持账户抽象化"><!---->支持账户抽象化<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/developer-guides/transactions/fee-model.html" class="nav-link sidebar-link sidebar-page" aria-label="费用机制"><!---->费用机制<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/developer-guides/bridging/bridging-asset.html" class="nav-link sidebar-link sidebar-page" aria-label="桥接资产"><!---->桥接资产<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/developer-guides/bridging/l1-l2-interop.html" class="nav-link sidebar-link sidebar-page" aria-label="L1/L2互操作性"><!---->L1/L2互操作性<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/developer-guides/bridging/l1-l2.html" class="nav-link sidebar-link sidebar-page" aria-label="L1-&gt;L2通信"><!---->L1-&gt;L2通信<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/developer-guides/bridging/l2-l1.html" class="nav-link sidebar-link sidebar-page" aria-label="L2 -&gt; L1通信"><!---->L2 -&gt; L1通信<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/developer-guides/videos.html" class="nav-link sidebar-link sidebar-page" aria-label="视频资源"><!---->视频资源<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/docs/dev/building-on-zksync" class="title">在 zkSync Era 上构建</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/docs/dev/building-on-zksync/hello-world.html" class="nav-link sidebar-link sidebar-page" aria-label="快速入门"><!---->快速入门<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/building-on-zksync/contracts/contracts.html" class="nav-link sidebar-link sidebar-page" aria-label="智能合约开发"><!---->智能合约开发<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/building-on-zksync/contracts/contract-deployment.html" class="nav-link sidebar-link sidebar-page" aria-label="合约部署"><!---->合约部署<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/building-on-zksync/contracts/contract-verification.html" class="nav-link sidebar-link sidebar-page" aria-label="验证合约"><!---->验证合约<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/building-on-zksync/events.html" class="nav-link sidebar-link sidebar-page" aria-label="处理事件"><!---->处理事件<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/building-on-zksync/rpc.html" class="nav-link sidebar-link sidebar-page" aria-label="JSON-RPC API"><!---->JSON-RPC API<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/building-on-zksync/fair-onboarding-alpha.html" class="nav-link sidebar-link sidebar-page" aria-label="公平入驻Alpha"><!---->公平入驻Alpha<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading clickable active"><!----><a href="/docs/dev/tutorials" class="title">教程</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/docs/dev/tutorials/cross-chain-tutorial.html" class="nav-link sidebar-link sidebar-page" aria-label="跨链治理"><!---->跨链治理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/tutorials/custom-aa-tutorial.html" class="nav-link sidebar-link sidebar-page" aria-label="帐户抽象自定义"><!---->帐户抽象自定义<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/tutorials/aa-daily-spend-limit.html" class="nav-link sidebar-link sidebar-page" aria-label="每日支出限额账户"><!---->每日支出限额账户<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="构建自定义的paymaster"><!---->构建自定义的paymaster<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#先决条件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="先决条件"><!---->先决条件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#安装依赖项" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="安装依赖项"><!---->安装依赖项<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#设计" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="设计"><!---->设计<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#解析paymaster的输入" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="解析paymaster的输入"><!---->解析paymaster的输入<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#paymaster的完整代码" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="paymaster的完整代码"><!---->paymaster的完整代码<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#部署一个erc20合约" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="部署一个ERC20合约"><!---->部署一个ERC20合约<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#部署支付系统" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="部署支付系统"><!---->部署支付系统<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#使用paymaster" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="使用paymaster"><!---->使用paymaster<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#常见错误" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="常见错误"><!---->常见错误<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#完整的项目" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="完整的项目"><!---->完整的项目<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#了解更多" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="了解更多"><!---->了解更多<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/docs/dev/troubleshooting" class="title">错误排除</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/docs/dev/troubleshooting/changelog.html" class="nav-link sidebar-link sidebar-page" aria-label="更改日志"><!---->更改日志<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/troubleshooting/docs-contribution/docs.html" class="nav-link sidebar-link sidebar-page" aria-label="贡献于文档"><!---->贡献于文档<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/troubleshooting/docs-contribution/community-resources.html" class="nav-link sidebar-link sidebar-page" aria-label="社区资源"><!---->社区资源<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/dev/troubleshooting/faq.html" class="nav-link sidebar-link sidebar-page" aria-label="常见问题"><!---->常见问题<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->构建自定义的paymaster</h1><div class="page-info"><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">On This Page</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#先决条件" class="router-link-active router-link-exact-active toc-link level2">先决条件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#安装依赖项" class="router-link-active router-link-exact-active toc-link level2">安装依赖项</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#设计" class="router-link-active router-link-exact-active toc-link level2">设计</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#解析paymaster的输入" class="router-link-active router-link-exact-active toc-link level3">解析paymaster的输入</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#paymaster的完整代码" class="router-link-active router-link-exact-active toc-link level3">paymaster的完整代码</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#部署一个erc20合约" class="router-link-active router-link-exact-active toc-link level2">部署一个ERC20合约</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#部署支付系统" class="router-link-active router-link-exact-active toc-link level2">部署支付系统</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#使用paymaster" class="router-link-active router-link-exact-active toc-link level2">使用paymaster</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#常见错误" class="router-link-active router-link-exact-active toc-link level2">常见错误</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#完整的项目" class="router-link-active router-link-exact-active toc-link level2">完整的项目</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/dev/tutorials/custom-paymaster-tutorial.html#了解更多" class="router-link-active router-link-exact-active toc-link level2">了解更多</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="构建自定义的paymaster" tabindex="-1"><a class="header-anchor" href="#构建自定义的paymaster" aria-hidden="true">#</a> 构建自定义的paymaster</h1><p>让我们看看如何使用paymaster功能来建立一个自定义的paymaster，让用户在我们的token中支付费用。在本教程中，我们将。</p><ul><li>创建一个paymaster，它将假设一个单位的ERC20代币足以支付任何交易费用。</li><li>创建ERC20代币合约并发送一些代币到一个全新的钱包。</li><li>最后我们将从新创建的钱包通过paymaster发送一个<code>mint</code>交易。尽管该交易通常需要一些ETH来支付汽油费，但我们的paymaster将执行该交易，以换取1单位的ERC20代币。</li></ul><h2 id="先决条件" tabindex="-1"><a class="header-anchor" href="#先决条件" aria-hidden="true">#</a> 先决条件</h2><p>为了更好地理解这个页面，我们建议你在深入学习本教程之前先阅读一下<a href="/docs/dev/tutorials/.../developer-guides/aa.html" class="">账户抽象设计</a>。</p><p>假设你已经熟悉在zkSync上部署智能合约。如果没有，请参考[快速入门教程]（.../building-onzksync/hello-world.md）的第一节。还建议阅读<a href="/docs/dev/tutorials/.../developer-guides/system-contracts.html" class="">系统合约介绍</a>。</p><h2 id="安装依赖项" tabindex="-1"><a class="header-anchor" href="#安装依赖项" aria-hidden="true">#</a> 安装依赖项</h2><p>我们将使用zkSync硬帽插件来开发这个合约。首先，我们应该为它安装所有的依赖项。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mkdir custom-paymaster-tutorial
cd custom-paymaster-tutorial
yarn init -y
yarn add -D typescript ts-node ethers@^5.7.2 zksync-web3@^0.13.1 hardhat @matterlabs/hardhat-zksync-solc @matterlabs/hardhat-zksync-deploy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>当前版本的<code>zksync-web3</code>使用<code>ethers v5.7.x</code>作为同行依赖。与<code>ethers v6.x.x</code>兼容的更新将很快发布。</p></div><p>由于我们正在使用zkSync合约，我们还需要安装带有合同及其对等依赖的软件包。</p><div class="language-shag-0-1gr0ag-0-1gr0ereag-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8l8lag-1-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ereag-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8l8lag-1-1gr0ere8lerag-1-1gr0ere8le8lag-1-1gag-0-1gr0ere8lr0ag-1-1gr0ere8lere8l line-numbers-mode" data-ext="shag-0-1gr0ag-0-1gr0ereag-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8l8lag-1-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ereag-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8l8lag-1-1gr0ere8lerag-1-1gr0ere8le8lag-1-1gag-0-1gr0ere8lr0ag-1-1gr0ere8lere8l"><pre class="language-shag-0-1gr0ag-0-1gr0ereag-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8l8lag-1-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ereag-0-1gr0ere8lagag-1-1gr0ere8l-0-1gr0ere8l8lag-1-1gr0ere8lerag-1-1gr0ere8le8lag-1-1gag-0-1gr0ere8lr0ag-1-1gr0ere8lere8l"><code>yarn add @matterlabs/zksync-contracts @openzeppelin/contracts @openzeppelin/contracts-upgradeable
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后创建<code>hardhat.config.ts</code>配置文件，<code>contracts</code>和<code>deploy</code>文件夹，就像<a href="/docs/dev/tutorials/.../building-on-zksync/hello-world.html" class="">快速入门教程</a>中那样。</p><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>你可以使用zkSync CLI来自动构建一个项目的支架。查找<a href="/docs/dev/tutorials/.../.../api/tools/zksync-cli/" class="">关于zkSync CLI的更多信息</a></p></div><h2 id="设计" tabindex="-1"><a class="header-anchor" href="#设计" aria-hidden="true">#</a> 设计</h2><p>我们的协议将是一个假协议，允许任何人交换某个ERC20代币，以换取支付交易费用。</p><p>paymaster的框架看起来是这样的。</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token comment">// SPDX-License-Identifier: MIT</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.0</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;@openzeppelin/contracts/token/ERC20/IERC20.sol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>IPaymaster<span class="token punctuation">,</span> ExecutionResult<span class="token punctuation">,</span> PAYMASTER_VALIDATION_SUCCESS_MAGIC<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@matterlabs/zksync-contracts/l2/system-contracts/interfaces/IPaymaster.sol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>IPaymasterFlow<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@matterlabs/zksync-contracts/l2/system-contracts/interfaces/IPaymasterFlow.sol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>TransactionHelper<span class="token punctuation">,</span> Transaction<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@matterlabs/zksync-contracts/l2/system-contracts/libraries/TransactionHelper.sol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;@matterlabs/zksync-contracts/l2/system-contracts/Constants.sol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">MyPaymaster</span> <span class="token keyword">is</span> IPaymaster <span class="token punctuation">{</span>
    <span class="token builtin">uint256</span> <span class="token keyword">constant</span> PRICE_FOR_PAYING_FEES <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token builtin">address</span> <span class="token keyword">public</span> allowedToken<span class="token punctuation">;</span>

    <span class="token keyword">modifier</span> <span class="token function">onlyBootloader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> BOOTLOADER_FORMAL_ADDRESS<span class="token punctuation">,</span> <span class="token string">&quot;Only bootloader can call this method&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Continue execution if called from the bootloader.</span>
        <span class="token keyword">_</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">address</span> _erc20<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        allowedToken <span class="token operator">=</span> _erc20<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">validateAndPayForPaymasterTransaction</span><span class="token punctuation">(</span>
        <span class="token builtin">bytes32</span><span class="token punctuation">,</span>
        <span class="token builtin">bytes32</span><span class="token punctuation">,</span>
        Transaction <span class="token keyword">calldata</span> _transaction
    <span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bytes4</span> magic<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// TO BE IMPLEMENTED</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">postTransaction</span><span class="token punctuation">(</span>
        <span class="token builtin">bytes</span> <span class="token keyword">calldata</span> _context<span class="token punctuation">,</span>
        Transaction <span class="token keyword">calldata</span> _transaction<span class="token punctuation">,</span>
        <span class="token builtin">bytes32</span><span class="token punctuation">,</span>
        <span class="token builtin">bytes32</span><span class="token punctuation">,</span>
        ExecutionResult _txResult<span class="token punctuation">,</span>
        <span class="token builtin">uint256</span> _maxRefundedGas
    <span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> override <span class="token punctuation">{</span>
        <span class="token comment">// Refunds are not supported yet.</span>
    <span class="token punctuation">}</span>

    <span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意，只有<a href="/docs/dev/tutorials/.../developer-guides/system-contracts.html#bootloader" class="">bootloader</a>才允许调用<code>validateAndPayForPaymasterTransaction</code>/<code>postOp</code>方法。这就是为什么对它们使用<code>onlyBootloader</code>修改器。</p><h3 id="解析paymaster的输入" tabindex="-1"><a class="header-anchor" href="#解析paymaster的输入" aria-hidden="true">#</a> 解析paymaster的输入</h3><p>在本教程中，我们想向用户收取一个单位的<code>allowedToken</code>以换取交易费用，这将由paymaster合同支付。</p><p>付款人应该收到的输入被编码为<code>paymasterInput</code>。正如<a href="/docs/dev/tutorials/.../developer-guides/aa.html#built-in-paymaster-flows" class="">在paymaster文档中</a>所述，有一些标准化的方法来编码用户与paymasterInput的互动。为了向用户收费，我们将要求她向paymaster合同提供足够的ERC20代币的津贴。这个津贴是在幕后的 &quot;approvalBased &quot;流程中完成的。</p><p>首先，我们需要检查 &quot;paymasterInput &quot;是否像 &quot;approvalBased &quot;流程中那样被编码，并且 &quot;paymasterInput &quot;中发送的代币是支付者接受的。</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code>magic <span class="token operator">=</span> PAYMASTER_VALIDATION_SUCCESS_MAGIC<span class="token punctuation">;</span>

<span class="token keyword">require</span><span class="token punctuation">(</span>
    _transaction<span class="token punctuation">.</span>paymasterInput<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token string">&quot;The standard paymaster input must be at least 4 bytes long&quot;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token builtin">bytes4</span> paymasterInputSelector <span class="token operator">=</span> <span class="token builtin">bytes4</span><span class="token punctuation">(</span>_transaction<span class="token punctuation">.</span>paymasterInput<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>paymasterInputSelector <span class="token operator">==</span> IPaymasterFlow<span class="token punctuation">.</span>approvalBased<span class="token punctuation">.</span>selector<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token builtin">address</span> token<span class="token punctuation">,</span> <span class="token builtin">uint256</span> minAllowance<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> data<span class="token punctuation">)</span> <span class="token operator">=</span> abi<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>_transaction<span class="token punctuation">.</span>paymasterInput<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">,</span> <span class="token builtin">uint256</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// We verify that the user has provided enough allowance</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>token <span class="token operator">==</span> allowedToken<span class="token punctuation">,</span> <span class="token string">&quot;Invalid token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//</span>
    <span class="token comment">// ...</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">revert</span><span class="token punctuation">(</span><span class="token string">&quot;Unsupported paymaster flow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后，我们需要检查用户是否确实提供了足够的津贴。</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token comment">// We verify that the user has provided enough allowance</span>
<span class="token builtin">address</span> userAddress <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token builtin">uint160</span><span class="token punctuation">(</span>_transaction<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token builtin">address</span> thisAddress <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token builtin">uint256</span> providedAllowance <span class="token operator">=</span> <span class="token function">IERC20</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">allowance</span><span class="token punctuation">(</span>
    userAddress<span class="token punctuation">,</span>
    thisAddress
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">require</span><span class="token punctuation">(</span>providedAllowance <span class="token operator">&gt;=</span> PRICE_FOR_PAYING_FEES<span class="token punctuation">,</span> <span class="token string">&quot;Min allowance too low&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后，我们将检查交易费用是多少，将ERC20代币转移到paymaster，并将相应的气体费用从paymaster转移到bootloader以支付交易费用。</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token comment">// Note, that while the minimal amount of ETH needed is tx.gasPrice * tx.gasLimit,</span>
<span class="token comment">// neither paymaster nor account are allowed to access this context variable.</span>
<span class="token builtin">uint256</span> requiredETH <span class="token operator">=</span> _transaction<span class="token punctuation">.</span>gasLimit <span class="token operator">*</span>
    _transaction<span class="token punctuation">.</span>maxFeePerGas<span class="token punctuation">;</span>


try
    <span class="token function">IERC20</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transferFrom</span><span class="token punctuation">(</span>userAddress<span class="token punctuation">,</span> thisAddress<span class="token punctuation">,</span> amount<span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token punctuation">}</span> catch <span class="token punctuation">(</span><span class="token builtin">bytes</span> <span class="token keyword">memory</span> revertReason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// If the revert reason is empty or represented by just a function selector,</span>
    <span class="token comment">// we replace the error with a more user-friendly message</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>revertReason<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">revert</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to transferFrom from users&#39; account&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">assembly</span> <span class="token punctuation">{</span>
            <span class="token keyword">revert</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">,</span> revertReason<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mload</span><span class="token punctuation">(</span>revertReason<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Transfer fees to the bootloader</span>
<span class="token punctuation">(</span><span class="token builtin">bool</span> success<span class="token punctuation">,</span> <span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">payable</span><span class="token punctuation">(</span>BOOTLOADER_FORMAL_ADDRESS<span class="token punctuation">)</span><span class="token punctuation">.</span>call<span class="token punctuation">{</span>
    value<span class="token punctuation">:</span> requiredETH
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">require</span><span class="token punctuation">(</span>success<span class="token punctuation">,</span> <span class="token string">&quot;Failed to transfer funds to the bootloader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">你应该首先验证所有的要求</p><p>付费者节流的<a href="/docs/dev/tutorials/.../developer-guides/aa.html#the-validation-step" class="">规则</a>说，如果第一个与API上的执行不同的存储读取值是属于用户的存储槽，那么付费者就不会被节流了。</p><p>这就是为什么在执行任何逻辑之前，必须验证用户是否为交易提供了所有允许的前提条件_。这就是我们_首先_检查用户是否提供了足够的许可，然后才进行<code>transferFrom</code>的原因。</p></div><h3 id="paymaster的完整代码" tabindex="-1"><a class="header-anchor" href="#paymaster的完整代码" aria-hidden="true">#</a> paymaster的完整代码</h3><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token comment">// SPDX-License-Identifier: MIT</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.0</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;@openzeppelin/contracts/token/ERC20/IERC20.sol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>IPaymaster<span class="token punctuation">,</span> ExecutionResult<span class="token punctuation">,</span> PAYMASTER_VALIDATION_SUCCESS_MAGIC<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@matterlabs/zksync-contracts/l2/system-contracts/interfaces/IPaymaster.sol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>IPaymasterFlow<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@matterlabs/zksync-contracts/l2/system-contracts/interfaces/IPaymasterFlow.sol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>TransactionHelper<span class="token punctuation">,</span> Transaction<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@matterlabs/zksync-contracts/l2/system-contracts/libraries/TransactionHelper.sol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;@matterlabs/zksync-contracts/l2/system-contracts/Constants.sol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">MyPaymaster</span> <span class="token keyword">is</span> IPaymaster <span class="token punctuation">{</span>
    <span class="token builtin">uint256</span> <span class="token keyword">constant</span> PRICE_FOR_PAYING_FEES <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token builtin">address</span> <span class="token keyword">public</span> allowedToken<span class="token punctuation">;</span>

    <span class="token keyword">modifier</span> <span class="token function">onlyBootloader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>
            msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> BOOTLOADER_FORMAL_ADDRESS<span class="token punctuation">,</span>
            <span class="token string">&quot;Only bootloader can call this method&quot;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Continue execution if called from the bootloader.</span>
        <span class="token keyword">_</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">address</span> _erc20<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        allowedToken <span class="token operator">=</span> _erc20<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">validateAndPayForPaymasterTransaction</span><span class="token punctuation">(</span>
        <span class="token builtin">bytes32</span><span class="token punctuation">,</span>
        <span class="token builtin">bytes32</span><span class="token punctuation">,</span>
        Transaction <span class="token keyword">calldata</span> _transaction
    <span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bytes4</span> magic<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// By default we consider the transaction as accepted.</span>
        magic <span class="token operator">=</span> PAYMASTER_VALIDATION_SUCCESS_MAGIC<span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>
            _transaction<span class="token punctuation">.</span>paymasterInput<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">,</span>
            <span class="token string">&quot;The standard paymaster input must be at least 4 bytes long&quot;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token builtin">bytes4</span> paymasterInputSelector <span class="token operator">=</span> <span class="token builtin">bytes4</span><span class="token punctuation">(</span>
            _transaction<span class="token punctuation">.</span>paymasterInput<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>paymasterInputSelector <span class="token operator">==</span> IPaymasterFlow<span class="token punctuation">.</span>approvalBased<span class="token punctuation">.</span>selector<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// While the transaction data consists of address, uint256 and bytes data,</span>
            <span class="token comment">// the data is not needed for this paymaster</span>
            <span class="token punctuation">(</span><span class="token builtin">address</span> token<span class="token punctuation">,</span> <span class="token builtin">uint256</span> amount<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> data<span class="token punctuation">)</span> <span class="token operator">=</span> abi<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>
                _transaction<span class="token punctuation">.</span>paymasterInput<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">,</span> <span class="token builtin">uint256</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Verify if token is the correct one</span>
            <span class="token keyword">require</span><span class="token punctuation">(</span>token <span class="token operator">==</span> allowedToken<span class="token punctuation">,</span> <span class="token string">&quot;Invalid token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// We verify that the user has provided enough allowance</span>
            <span class="token builtin">address</span> userAddress <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token builtin">uint160</span><span class="token punctuation">(</span>_transaction<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token builtin">address</span> thisAddress <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token builtin">uint256</span> providedAllowance <span class="token operator">=</span> <span class="token function">IERC20</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">allowance</span><span class="token punctuation">(</span>
                userAddress<span class="token punctuation">,</span>
                thisAddress
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">require</span><span class="token punctuation">(</span>
                providedAllowance <span class="token operator">&gt;=</span> PRICE_FOR_PAYING_FEES<span class="token punctuation">,</span>
                <span class="token string">&quot;Min allowance too low&quot;</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Note, that while the minimal amount of ETH needed is tx.gasPrice * tx.gasLimit,</span>
            <span class="token comment">// neither paymaster nor account are allowed to access this context variable.</span>
            <span class="token builtin">uint256</span> requiredETH <span class="token operator">=</span> _transaction<span class="token punctuation">.</span>gasLimit <span class="token operator">*</span>
                _transaction<span class="token punctuation">.</span>maxFeePerGas<span class="token punctuation">;</span>

            try
                <span class="token function">IERC20</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transferFrom</span><span class="token punctuation">(</span>userAddress<span class="token punctuation">,</span> thisAddress<span class="token punctuation">,</span> amount<span class="token punctuation">)</span>
            <span class="token punctuation">{</span><span class="token punctuation">}</span> catch <span class="token punctuation">(</span><span class="token builtin">bytes</span> <span class="token keyword">memory</span> revertReason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// If the revert reason is empty or represented by just a function selector,</span>
                <span class="token comment">// we replace the error with a more user-friendly message</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>revertReason<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">revert</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to transferFrom from users&#39; account&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">assembly</span> <span class="token punctuation">{</span>
                        <span class="token keyword">revert</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">,</span> revertReason<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mload</span><span class="token punctuation">(</span>revertReason<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// The bootloader never returns any data, so it can safely be ignored here.</span>
            <span class="token punctuation">(</span><span class="token builtin">bool</span> success<span class="token punctuation">,</span> <span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">payable</span><span class="token punctuation">(</span>BOOTLOADER_FORMAL_ADDRESS<span class="token punctuation">)</span><span class="token punctuation">.</span>call<span class="token punctuation">{</span>
                value<span class="token punctuation">:</span> requiredETH
            <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">require</span><span class="token punctuation">(</span>success<span class="token punctuation">,</span> <span class="token string">&quot;Failed to transfer funds to the bootloader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">revert</span><span class="token punctuation">(</span><span class="token string">&quot;Unsupported paymaster flow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">postTransaction</span><span class="token punctuation">(</span>
        <span class="token builtin">bytes</span> <span class="token keyword">calldata</span> _context<span class="token punctuation">,</span>
        Transaction <span class="token keyword">calldata</span> _transaction<span class="token punctuation">,</span>
        <span class="token builtin">bytes32</span><span class="token punctuation">,</span>
        <span class="token builtin">bytes32</span><span class="token punctuation">,</span>
        ExecutionResult _txResult<span class="token punctuation">,</span>
        <span class="token builtin">uint256</span> _maxRefundedGas
    <span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> override <span class="token punctuation">{</span>
        <span class="token comment">// Refunds are not supported yet.</span>
    <span class="token punctuation">}</span>

    <span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="部署一个erc20合约" tabindex="-1"><a class="header-anchor" href="#部署一个erc20合约" aria-hidden="true">#</a> 部署一个ERC20合约</h2><p>为了测试我们的支付系统，我们需要一个ERC20代币，所以我们要部署一个。为了简单起见，我们将使用一个稍加修改的OpenZeppelin实现它。</p><p>创建 &quot;MyERC20.sol &quot;文件，并将以下代码放入其中。</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token comment">// SPDX-License-Identifier: UNLICENSED</span>

<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.0</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;@openzeppelin/contracts/token/ERC20/ERC20.sol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">MyERC20</span> <span class="token keyword">is</span> ERC20 <span class="token punctuation">{</span>
    <span class="token builtin">uint8</span> <span class="token keyword">private</span> _decimals<span class="token punctuation">;</span>

    <span class="token keyword">constructor</span><span class="token punctuation">(</span>
        <span class="token builtin">string</span> <span class="token keyword">memory</span> name_<span class="token punctuation">,</span>
        <span class="token builtin">string</span> <span class="token keyword">memory</span> symbol_<span class="token punctuation">,</span>
        <span class="token builtin">uint8</span> decimals_
    <span class="token punctuation">)</span> <span class="token function">ERC20</span><span class="token punctuation">(</span>name_<span class="token punctuation">,</span> symbol_<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _decimals <span class="token operator">=</span> decimals_<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">mint</span><span class="token punctuation">(</span><span class="token builtin">address</span> _to<span class="token punctuation">,</span> <span class="token builtin">uint256</span> _amount<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">_mint</span><span class="token punctuation">(</span>_to<span class="token punctuation">,</span> _amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">decimals</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> override <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _decimals<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="部署支付系统" tabindex="-1"><a class="header-anchor" href="#部署支付系统" aria-hidden="true">#</a> 部署支付系统</h2><p>为了部署ERC20代币和paymaster，我们需要创建一个部署脚本。创建<code>deploy</code>文件夹并在那里创建一个文件。<code>deploy-paymaster.ts</code>。把下面的部署脚本放在那里。</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> utils<span class="token punctuation">,</span> Wallet <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;zksync-web3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ethers <span class="token keyword">from</span> <span class="token string">&quot;ethers&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HardhatRuntimeEnvironment <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;hardhat/types&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Deployer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@matterlabs/hardhat-zksync-deploy&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>hre<span class="token operator">:</span> HardhatRuntimeEnvironment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// The wallet that will deploy the token and the paymaster</span>
  <span class="token comment">// It is assumed that this wallet already has sufficient funds on zkSync</span>
  <span class="token comment">// ⚠️ Never commit private keys to file tracking history, or your account could be compromised.</span>
  <span class="token keyword">const</span> wallet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Wallet</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;PRIVATE-KEY&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// The wallet that will receive ERC20 tokens</span>
  <span class="token keyword">const</span> emptyWallet <span class="token operator">=</span> Wallet<span class="token punctuation">.</span><span class="token function">createRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Empty wallet&#39;s address: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>emptyWallet<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Empty wallet&#39;s private key: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>emptyWallet<span class="token punctuation">.</span>privateKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> deployer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Deployer</span><span class="token punctuation">(</span>hre<span class="token punctuation">,</span> wallet<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Deploying the ERC20 token</span>
  <span class="token keyword">const</span> erc20Artifact <span class="token operator">=</span> <span class="token keyword">await</span> deployer<span class="token punctuation">.</span><span class="token function">loadArtifact</span><span class="token punctuation">(</span><span class="token string">&quot;MyERC20&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> erc20 <span class="token operator">=</span> <span class="token keyword">await</span> deployer<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span>erc20Artifact<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;MyToken&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;MyToken&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ERC20 address: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>erc20<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Deploying the paymaster</span>
  <span class="token keyword">const</span> paymasterArtifact <span class="token operator">=</span> <span class="token keyword">await</span> deployer<span class="token punctuation">.</span><span class="token function">loadArtifact</span><span class="token punctuation">(</span><span class="token string">&quot;MyPaymaster&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> paymaster <span class="token operator">=</span> <span class="token keyword">await</span> deployer<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span>paymasterArtifact<span class="token punctuation">,</span> <span class="token punctuation">[</span>erc20<span class="token punctuation">.</span>address<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Paymaster address: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>paymaster<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Supplying paymaster with ETH</span>
  <span class="token keyword">await</span> <span class="token punctuation">(</span>
    <span class="token keyword">await</span> deployer<span class="token punctuation">.</span>zkWallet<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      to<span class="token operator">:</span> paymaster<span class="token punctuation">.</span>address<span class="token punctuation">,</span>
      value<span class="token operator">:</span> ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">parseEther</span><span class="token punctuation">(</span><span class="token string">&quot;0.03&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Supplying the ERC20 tokens to the empty wallet:</span>
  <span class="token keyword">await</span> <span class="token comment">// We will give the empty wallet 3 units of the token:</span>
  <span class="token punctuation">(</span><span class="token keyword">await</span> erc20<span class="token punctuation">.</span><span class="token function">mint</span><span class="token punctuation">(</span>emptyWallet<span class="token punctuation">.</span>address<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Minted 3 tokens for the empty wallet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Done!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>除了部署paymaster，它还创建了一个空钱包，并将一些`MyERC20&#39;代币开采到其中，以便以后可以使用paymaster。</p><p>为了部署ERC20代币和paymaster，你应该编译合约并运行该脚本。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yarn hardhat compile
yarn hardhat deploy-zksync --script deploy-paymaster.ts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果应该大致如下。</p><div class="language-ag-0-1gr0ere8lag-1-1gr0ere8l line-numbers-mode" data-ext="ag-0-1gr0ere8lag-1-1gr0ere8l"><pre class="language-ag-0-1gr0ere8lag-1-1gr0ere8l"><code>Empty wallet&#39;s address: 0xAd155D3069BB3c587E995916B320444056d8191F
Empty wallet&#39;s private key: 0x236d735297617cc68f4ec8ceb40b351ca5be9fc585d446fa95dff02354ac04fb
ERC20 address: 0x65C899B5fb8Eb9ae4da51D67E1fc417c7CB7e964
Paymaster address: 0x0a67078A35745947A37A552174aFe724D8180c25
Minted 3 tokens for the empty wallet
Done!
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意，每次运行的地址和私钥将是不同的。</p><h2 id="使用paymaster" tabindex="-1"><a class="header-anchor" href="#使用paymaster" aria-hidden="true">#</a> 使用paymaster</h2><p>在<code>deploy</code>文件夹中创建<code>use-paymaster.ts</code>脚本。你可以在下面的代码段中看到与paymaster交互的例子。</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Provider<span class="token punctuation">,</span> utils<span class="token punctuation">,</span> Wallet <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;zksync-web3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ethers <span class="token keyword">from</span> <span class="token string">&quot;ethers&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HardhatRuntimeEnvironment <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;hardhat/types&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Put the address of the deployed paymaster here</span>
<span class="token keyword">const</span> <span class="token constant">PAYMASTER_ADDRESS</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;PAYMASTER_ADDRESS&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Put the address of the ERC20 token here:</span>
<span class="token keyword">const</span> <span class="token constant">TOKEN_ADDRESS</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;TOKEN_ADDRESS&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Wallet private key</span>
<span class="token comment">// ⚠️ Never commit private keys to file tracking history, or your account could be compromised.</span>
<span class="token keyword">const</span> <span class="token constant">EMPTY_WALLET_PRIVATE_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;EMPTY_WALLET_PRIVATE_KEY&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>hre<span class="token operator">:</span> HardhatRuntimeEnvironment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> provider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Provider</span><span class="token punctuation">(</span><span class="token string">&quot;https://zksync2-testnet.zksync.dev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> emptyWallet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Wallet</span><span class="token punctuation">(</span><span class="token constant">EMPTY_WALLET_PRIVATE_KEY</span><span class="token punctuation">,</span> provider<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Obviously this step is not required, but it is here purely to demonstrate that indeed the wallet has no ether.</span>
  <span class="token keyword">const</span> ethBalance <span class="token operator">=</span> <span class="token keyword">await</span> emptyWallet<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ethBalance<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;The wallet is not empty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Balance of the user before mint: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">await</span> emptyWallet<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>
      <span class="token constant">TOKEN_ADDRESS</span>
    <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> erc20 <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span>hre<span class="token punctuation">,</span> emptyWallet<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> gasPrice <span class="token operator">=</span> <span class="token keyword">await</span> provider<span class="token punctuation">.</span><span class="token function">getGasPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Encoding the &quot;ApprovalBased&quot; paymaster flow&#39;s input</span>
  <span class="token keyword">const</span> paymasterParams <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">getPaymasterParams</span><span class="token punctuation">(</span><span class="token constant">PAYMASTER_ADDRESS</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&quot;ApprovalBased&quot;</span><span class="token punctuation">,</span>
    token<span class="token operator">:</span> <span class="token constant">TOKEN_ADDRESS</span><span class="token punctuation">,</span>
    <span class="token comment">// set minimalAllowance as we defined in the paymaster contract</span>
    minimalAllowance<span class="token operator">:</span> ethers<span class="token punctuation">.</span>BigNumber<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// empty bytes as testnet paymaster does not use innerInput</span>
    innerInput<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Estimate gas fee for mint transaction</span>
  <span class="token keyword">const</span> gasLimit <span class="token operator">=</span> <span class="token keyword">await</span> erc20<span class="token punctuation">.</span>estimateGas<span class="token punctuation">.</span><span class="token function">mint</span><span class="token punctuation">(</span>emptyWallet<span class="token punctuation">.</span>address<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    customData<span class="token operator">:</span> <span class="token punctuation">{</span>
      gasPerPubdata<span class="token operator">:</span> utils<span class="token punctuation">.</span><span class="token constant">DEFAULT_GAS_PER_PUBDATA_LIMIT</span><span class="token punctuation">,</span>
      paymasterParams<span class="token operator">:</span> paymasterParams<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> fee <span class="token operator">=</span> gasPrice<span class="token punctuation">.</span><span class="token function">mul</span><span class="token punctuation">(</span>gasLimit<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> <span class="token punctuation">(</span>
    <span class="token keyword">await</span> erc20<span class="token punctuation">.</span><span class="token function">mint</span><span class="token punctuation">(</span>emptyWallet<span class="token punctuation">.</span>address<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment">// paymaster info</span>
      customData<span class="token operator">:</span> <span class="token punctuation">{</span>
        paymasterParams<span class="token operator">:</span> paymasterParams<span class="token punctuation">,</span>
        gasPerPubdata<span class="token operator">:</span> utils<span class="token punctuation">.</span><span class="token constant">DEFAULT_GAS_PER_PUBDATA_LIMIT</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Balance of the user after mint: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">await</span> emptyWallet<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>
      <span class="token constant">TOKEN_ADDRESS</span>
    <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在填写完参数<code>PAYMASTER_ADDRESS&#39;、</code>TOKEN_ADDRESS&#39;和`EMPTY_WALLET_PRIVATE_KEY&#39;与上一步提供的输出后。</p><div class="hint-container warning"><p class="hint-container-title">Note</p><p>重要的是! 确保你使用的是之前脚本所创建的钱包的私钥，因为该钱包包含ERC20代币</p></div><p>用以下命令运行这个脚本。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yarn hardhat deploy-zksync --script use-paymaster.ts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>输出结果应该大致如下。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Balance of the user before mint: 3
Balance of the user after mint: 102
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>运行部署脚本后，钱包里有3个代币，在向<code>mint</code>发送交易后，又有100个代币，余额为102，因为有1个代币被用来支付交易费用给支付者。</p><h2 id="常见错误" tabindex="-1"><a class="header-anchor" href="#常见错误" aria-hidden="true">#</a> 常见错误</h2><p>如果<code>use-paymaster.ts</code>脚本失败，出现错误<code>提交交易失败。验证交易失败。原因是。验证重启。Paymaster验证错误。向bootloader转移资金失败</code>，请尝试向paymaster发送额外的ETH，以便它有足够的资金来支付交易。你可以使用[zkSync Portal]（https://portal.zksync.io/）。</p><p>如果<code>use-paymaster.ts</code>脚本在铸造新的ERC20代币时失败，出现<code>错误：交易失败</code>，并且交易在<a href="https://explorer.zksync.io/" target="_blank" rel="noopener noreferrer">zkSync explorer<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>中出现状态 &quot;失败&quot;，请通过<a href="https://join.zksync.dev/" target="_blank" rel="noopener noreferrer">我们的Discord<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>或<a href="https://zksync.io/contact.html" target="_blank" rel="noopener noreferrer">联系页面<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>与我们接触。作为一个解决方法，尝试在交易中包括一个特定的<code>gasLimit</code>值。</p><h2 id="完整的项目" tabindex="-1"><a class="header-anchor" href="#完整的项目" aria-hidden="true">#</a> 完整的项目</h2><p>你可以下载完整的项目<a href="https://github.com/matter-labs/custom-paymaster-tutorial" target="_blank" rel="noopener noreferrer">这里<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><h2 id="了解更多" tabindex="-1"><a class="header-anchor" href="#了解更多" aria-hidden="true">#</a> 了解更多</h2><ul><li>要了解更多关于zkSync上L1-&gt;L2的交互，请查看<a href="/docs/dev/developer-guides/bridging/l1-l2.html" class="">document</a>。</li><li>要了解更多关于<code>zksync-web3</code>SDK的信息，请查看其<a href="././api/js">文档</a>。</li><li>要了解更多关于zkSync hardhat插件的信息，请查看其<a href="../../api/hardhat">document</a>。</li></ul></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/matter-labs/zksync-web-v2-docs/edit/main/docs/dev/tutorials/custom-paymaster-tutorial.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">Last update: </span><!----></div><div class="meta-item contributors"><span class="label">Contributors: </span><!--[--><!--[--><span class="contributor" title="email: aug@matterlabs.dev">Antonio</span>,<!--]--><!--[--><span class="contributor" title="email: bkrofegha@gmail.com">Blessing Krofegha</span>,<!--]--><!--[--><span class="contributor" title="email: stanislavbezkor@gmail.com">Stanislav Bezkorovainyi</span>,<!--]--><!--[--><span class="contributor" title="email: 280611875@qq.com">Newbee740</span>,<!--]--><!--[--><span class="contributor" title="email: 35497694+barakshani@users.noreply.github.com">barakshani</span>,<!--]--><!--[--><span class="contributor" title="email: 42230936+bxpana@users.noreply.github.com">bxpana</span>,<!--]--><!--[--><span class="contributor" title="email: 73983677+omahs@users.noreply.github.com">omahs</span>,<!--]--><!--[--><span class="contributor" title="email: tonioufa@gmail.com">Antonio</span>,<!--]--><!--[--><span class="contributor" title="email: dimitris.apostolou@icloud.com">Dimitris Apostolou</span>,<!--]--><!--[--><span class="contributor" title="email: nicobevilacqua@gmail.com">Nicolás Bevilacqua</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/docs/dev/tutorials/aa-daily-spend-limit.html" class="nav-link prev" aria-label="每日支出限额账户"><div class="hint"><span class="arrow left"></span>Prev</div><div class="link"><!---->每日支出限额账户</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Made with ❤️ by <a href='https://matter-labs.io/'> Matter Labs</a></div><!----></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/docs/assets/app-9b0e9180.js" defer></script>
  </body>
</html>
