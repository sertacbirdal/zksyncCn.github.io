<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>L2 -&gt; L1 communication | zkSync — Accelerating the mass adoption of crypto for personal sovereignty</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="/__/firebase/7.13.2/firebase-app.js" defer="true"></script>
    <script src="/__/firebase/7.13.2/firebase-analytics.js" defer="true"></script>
    <script src="/__/firebase/init.js" defer="true"></script>
    <script>
  const logoUrlChanger = setInterval(function() {
    //Anchor above the logo image
    const homeEls = document.getElementsByClassName("home-link");
    if(homeEls.length > 0) {
      const homeEl = homeEls[0];
      homeEl.setAttribute("href", "https://zksync.io");
      homeEl.setAttribute("onclick", "document.location='https://zksync.io';return false;");
      clearInterval(logoUrlChanger);
    }

    //Actual logo image
    const logoEls = document.getElementsByClassName("logo")
    if(logoEls.length > 0) {
      const logoEl = logoEls[0]
      logoEl.setAttribute("onclick", "document.location='https://zksync.io';return false;");
      clearInterval(logoUrlChanger);
    }
  }, 1000)</script>
    <meta name="description" content="zkSync is a ZK rollup that represents the end-game for scaling Ethereum - one that scales its technology and values without degrading security or decentralization">
    
    <link rel="preload" href="/assets/css/0.styles.350a0b01.css" as="style"><link rel="preload" href="/assets/js/app.7b8ca578.js" as="script"><link rel="preload" href="/assets/js/2.5a73362d.js" as="script"><link rel="preload" href="/assets/js/49.2a6881e2.js" as="script"><link rel="prefetch" href="/assets/js/10.1d31b665.js"><link rel="prefetch" href="/assets/js/11.f493f97a.js"><link rel="prefetch" href="/assets/js/12.0a46d712.js"><link rel="prefetch" href="/assets/js/13.e7352fdc.js"><link rel="prefetch" href="/assets/js/14.0c7cfd9a.js"><link rel="prefetch" href="/assets/js/15.94b050a9.js"><link rel="prefetch" href="/assets/js/16.b8c52aa4.js"><link rel="prefetch" href="/assets/js/17.7e3694b3.js"><link rel="prefetch" href="/assets/js/18.523d436b.js"><link rel="prefetch" href="/assets/js/19.248e6c74.js"><link rel="prefetch" href="/assets/js/20.abf592a4.js"><link rel="prefetch" href="/assets/js/21.51ea3602.js"><link rel="prefetch" href="/assets/js/22.d2979550.js"><link rel="prefetch" href="/assets/js/23.402a0d23.js"><link rel="prefetch" href="/assets/js/24.6bacca56.js"><link rel="prefetch" href="/assets/js/25.afe0dc2b.js"><link rel="prefetch" href="/assets/js/26.1d5572a0.js"><link rel="prefetch" href="/assets/js/27.a115d37b.js"><link rel="prefetch" href="/assets/js/28.8dee3885.js"><link rel="prefetch" href="/assets/js/29.1a1c57dd.js"><link rel="prefetch" href="/assets/js/3.d90af0c5.js"><link rel="prefetch" href="/assets/js/30.9cd7b1a3.js"><link rel="prefetch" href="/assets/js/31.51c62990.js"><link rel="prefetch" href="/assets/js/32.665572a2.js"><link rel="prefetch" href="/assets/js/33.018706b6.js"><link rel="prefetch" href="/assets/js/34.55102de6.js"><link rel="prefetch" href="/assets/js/35.2f4d0897.js"><link rel="prefetch" href="/assets/js/36.d86e7687.js"><link rel="prefetch" href="/assets/js/37.6310a1d0.js"><link rel="prefetch" href="/assets/js/38.52314fd5.js"><link rel="prefetch" href="/assets/js/39.9ac412c7.js"><link rel="prefetch" href="/assets/js/4.f44bd373.js"><link rel="prefetch" href="/assets/js/40.303d81a3.js"><link rel="prefetch" href="/assets/js/41.6e2303a5.js"><link rel="prefetch" href="/assets/js/42.9d963b05.js"><link rel="prefetch" href="/assets/js/43.a93166b9.js"><link rel="prefetch" href="/assets/js/44.6e1a6fcc.js"><link rel="prefetch" href="/assets/js/45.4fbbea7f.js"><link rel="prefetch" href="/assets/js/46.9ce3f58c.js"><link rel="prefetch" href="/assets/js/47.d6b951c1.js"><link rel="prefetch" href="/assets/js/48.5a3734c4.js"><link rel="prefetch" href="/assets/js/5.3964cc5a.js"><link rel="prefetch" href="/assets/js/50.7dcd49ad.js"><link rel="prefetch" href="/assets/js/51.6d547b98.js"><link rel="prefetch" href="/assets/js/52.afdd09d2.js"><link rel="prefetch" href="/assets/js/53.70102f1d.js"><link rel="prefetch" href="/assets/js/54.2e3038e3.js"><link rel="prefetch" href="/assets/js/55.b162aa77.js"><link rel="prefetch" href="/assets/js/56.fe219180.js"><link rel="prefetch" href="/assets/js/57.fc29b145.js"><link rel="prefetch" href="/assets/js/58.c89685dc.js"><link rel="prefetch" href="/assets/js/59.04d5061e.js"><link rel="prefetch" href="/assets/js/6.fd04f34e.js"><link rel="prefetch" href="/assets/js/60.393042fa.js"><link rel="prefetch" href="/assets/js/61.df0f09f2.js"><link rel="prefetch" href="/assets/js/62.1a9541a9.js"><link rel="prefetch" href="/assets/js/63.ea0501a4.js"><link rel="prefetch" href="/assets/js/64.ebd6db8c.js"><link rel="prefetch" href="/assets/js/65.ea970aff.js"><link rel="prefetch" href="/assets/js/66.ac257db5.js"><link rel="prefetch" href="/assets/js/67.3c815a55.js"><link rel="prefetch" href="/assets/js/68.c6fed9d6.js"><link rel="prefetch" href="/assets/js/69.937986ed.js"><link rel="prefetch" href="/assets/js/7.9cb55bb9.js"><link rel="prefetch" href="/assets/js/70.25b1f05d.js"><link rel="prefetch" href="/assets/js/71.6812e6cd.js"><link rel="prefetch" href="/assets/js/72.be287cf6.js"><link rel="prefetch" href="/assets/js/73.0d4f65f9.js"><link rel="prefetch" href="/assets/js/74.1d200155.js"><link rel="prefetch" href="/assets/js/75.eaafcd32.js"><link rel="prefetch" href="/assets/js/76.1dd3556b.js"><link rel="prefetch" href="/assets/js/8.f9eaafb5.js"><link rel="prefetch" href="/assets/js/9.2e9fb4a6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.350a0b01.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/LogotypeLight.svg" alt="zkSync — Accelerating the mass adoption of crypto for personal sovereignty" class="logo"> <span class="site-name can-hide">zkSync — Accelerating the mass adoption of crypto for personal sovereignty</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/dev/" class="nav-link router-link-active">
  开发文档
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  工具/SDK
</a></div><div class="nav-item"><a href="/contact.html" class="nav-link">
  联系我们
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="v2.0" class="dropdown-title"><span class="title">v2.0</span> <span class="arrow down"></span></button> <button type="button" aria-label="v2.0" class="mobile-dropdown-title"><span class="title">v2.0</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dev/" class="nav-link router-link-active">
  v2.0
</a></li><li class="dropdown-item"><!----> <a href="https://docs.zksync.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  v1.x
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/matter-labs/zksync-web-v2-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/dev/" class="nav-link router-link-active">
  开发文档
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  工具/SDK
</a></div><div class="nav-item"><a href="/contact.html" class="nav-link">
  联系我们
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="v2.0" class="dropdown-title"><span class="title">v2.0</span> <span class="arrow down"></span></button> <button type="button" aria-label="v2.0" class="mobile-dropdown-title"><span class="title">v2.0</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dev/" class="nav-link router-link-active">
  v2.0
</a></li><li class="dropdown-item"><!----> <a href="https://docs.zksync.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  v1.x
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/matter-labs/zksync-web-v2-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/dev/" aria-current="page" class="sidebar-link">介绍</a></li><li><section class="sidebar-group depth-0"><a href="/dev/fundamentals" class="sidebar-heading clickable"><span>开始</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/fundamentals/rollups.html" class="sidebar-link">rollups 介绍</a></li><li><a href="/dev/fundamentals/zkSync.html" class="sidebar-link">zkSync 基础知识</a></li><li><a href="/dev/fundamentals/testnet.html" class="sidebar-link">zkSync 测试网</a></li><li><a href="/dev/fundamentals/faq.html" class="sidebar-link">FAQ</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/dev/developer-guides" class="sidebar-heading clickable router-link-active open"><span>关于zkSync</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/developer-guides/transactions/transactions.html" class="sidebar-link">交易</a></li><li><a href="/dev/developer-guides/transactions/blocks.html" class="sidebar-link">区块</a></li><li><a href="/dev/developer-guides/contracts/system-contracts.html" class="sidebar-link">系统合约</a></li><li><a href="/dev/developer-guides/aa.html" class="sidebar-link">Account abstraction support</a></li><li><a href="/dev/developer-guides/security.html" class="sidebar-link">Security model</a></li><li><a href="/dev/developer-guides/transactions/fee-model.html" class="sidebar-link">Fee mechanism</a></li><li><a href="/dev/developer-guides/bridging/bridging-asset.html" class="sidebar-link">Bridging assets</a></li><li><a href="/dev/developer-guides/bridging/l1-l2-interop.html" class="sidebar-link">L1 / L2 Interoperability</a></li><li><a href="/dev/developer-guides/bridging/l1-l2.html" class="sidebar-link">L1 -&gt; L2 communication</a></li><li><a href="/dev/developer-guides/bridging/l2-l1.html" aria-current="page" class="active sidebar-link">L2 -&gt; L1 communication</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev/developer-guides/bridging/l2-l1.html#structure" class="sidebar-link">Structure</a></li><li class="sidebar-sub-header"><a href="/dev/developer-guides/bridging/l2-l1.html#sending-a-message-from-l2-to-l1" class="sidebar-link">Sending a message from L2 to L1</a></li><li class="sidebar-sub-header"><a href="/dev/developer-guides/bridging/l2-l1.html#prove-the-inclusion-of-the-message-into-the-l2-block" class="sidebar-link">Prove the inclusion of the message into the L2 block</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/dev/developer-guides/building-on-zksync" class="sidebar-heading clickable"><span>在zkSync上构建</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/developer-guides/hello-world.html" class="sidebar-link">Quickstart</a></li><li><a href="/dev/developer-guides/contracts/contracts.html" class="sidebar-link">合约部署</a></li><li><a href="/dev/developer-guides/contracts/contract-verification.html" class="sidebar-link">Verify smart contracts</a></li><li><a href="/dev/developer-guides/building-on-zksync/events.html" class="sidebar-link">Handling events</a></li><li><a href="/dev/developer-guides/building-on-zksync/rpc.html" class="sidebar-link">JSON-RPC API</a></li><li><a href="/dev/developer-guides/building-on-zksync/videos.html" class="sidebar-link">Video resources</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/dev/tutorials" class="sidebar-heading clickable"><span>教程</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/tutorials/cross-chain-tutorial.html" class="sidebar-link">Cross-chain governance</a></li><li><a href="/dev/tutorials/custom-aa-tutorial.html" class="sidebar-link">Account abstraction</a></li><li><a href="/dev/tutorials/custom-paymaster-tutorial.html" class="sidebar-link">Building custom paymaster</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/dev/troubleshooting" class="sidebar-heading clickable"><span>错误排除</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/troubleshooting/important-links.html" class="sidebar-link">Important links</a></li><li><a href="/dev/troubleshooting/status.html" class="sidebar-link">Feature support status</a></li><li><a href="/dev/troubleshooting/docs-contribution/docs.html" class="sidebar-link">文档贡献指南</a></li><li><a href="/dev/troubleshooting/docs-contribution/community-resources.html" class="sidebar-link">Community resources</a></li><li><a href="/dev/troubleshooting/known-issues.html" class="sidebar-link">Known issues</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="l2-l1-communication"><a href="#l2-l1-communication" class="header-anchor">#</a> L2 -&gt; L1 communication</h1> <p>This section describes the interface to interact with Ethereum from L2. It assumes that you are already familiar with the basic concepts of working with L2 -&gt; L1 communication. If you are new to this topic, you can read the conceptual introduction <a href="/dev/developer-guides/bridging/l1-l2-interop.html#l2-l1-communication">here</a>.</p> <h2 id="structure"><a href="#structure" class="header-anchor">#</a> Structure</h2> <p>Unlike L1 -&gt; L2 communication, it is impossible to directly initialize transactions from L2 to L1. However, you can send an arbitrary-length message from zkSync to Ethereum, and then handle the received message on an L1 smart contract.  To send a message from the L2 side, you should call the <code>sendToL1</code> method from the <a href="/dev/developer-guides/contracts/system-contracts.html#understanding-system-contracts##IL1Messenger">messenger system contract</a>. It accepts only the bytes of the message that is sent to the zkSync smart contract on Ethereum.</p> <p>From the L1 side, the zkSync smart contract provides the method <code>proveL2MessageInclusion</code> to prove that the message was sent to L1 and included in a zkSync block.</p> <h2 id="sending-a-message-from-l2-to-l1"><a href="#sending-a-message-from-l2-to-l1" class="header-anchor">#</a> Sending a message from L2 to L1</h2> <p>Sending messages from the L2 side requires users to call the <code>sendToL1</code> method from the <a href="/dev/developer-guides/contracts/system-contracts.html#understanding-system-contracts##IL1Messenger">Messenger system contract</a>. This method accepts only the bytes of the message that is being sent to the zkSync smart contract on L1.</p> <div class="language- extra-class"><pre class="language-text"><code>function sendToL1(bytes memory _message) external returns (bytes32 messageHash);
</code></pre></div><ul><li><code>_message</code> is a parameter that contains the raw bytes of the message</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The message sender will be determined from context.</p></div> <p>This function sends a message from L2 and returns the keccak256 hash of the message bytes. The message hash can be used later to get proof that the message was sent on L1. Its use is optional and is for convenience purposes only.</p> <p>More information about Messenger can be found in the <a href="/dev/developer-guides/contracts/system-contracts.html#understanding-system-contracts##IL1Messenger">system contracts section</a>.</p> <h3 id="examples"><a href="#examples" class="header-anchor">#</a> Examples</h3> <h4 id="sending-a-message-from-l2-to-l1-using-zksync-web3"><a href="#sending-a-message-from-l2-to-l1-using-zksync-web3" class="header-anchor">#</a> Sending a message from L2 to L1 using <code>zksync-web3</code></h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Wallet<span class="token punctuation">,</span> Provider<span class="token punctuation">,</span> Contract<span class="token punctuation">,</span> utils <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;zksync-web3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ethers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ethers&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">TEST_PRIVATE_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;YOUR_PRIVATE_KEY&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> zkSyncProvider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Provider</span><span class="token punctuation">(</span><span class="token string">&quot;https://zksync2-testnet.zksync.dev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> wallet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Wallet</span><span class="token punctuation">(</span><span class="token constant">TEST_PRIVATE_KEY</span><span class="token punctuation">,</span> zkSyncProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> messengerContract <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ethers</span><span class="token punctuation">.</span><span class="token function">Contract</span><span class="token punctuation">(</span>utils<span class="token punctuation">.</span><span class="token constant">L1_MESSENGER_ADDRESS</span><span class="token punctuation">,</span> utils<span class="token punctuation">.</span><span class="token constant">L1_MESSENGER</span><span class="token punctuation">,</span> wallet<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Messenger contract address is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>messengerContract<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> someString <span class="token operator">=</span> ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">toUtf8Bytes</span><span class="token punctuation">(</span><span class="token string">&quot;Some L2-&gt;L1 message&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Sending message from L2 to L1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> tx <span class="token operator">=</span> <span class="token keyword">await</span> messengerContract<span class="token punctuation">.</span><span class="token function">sendToL1</span><span class="token punctuation">(</span>someString<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;L2 trx hash is &quot;</span><span class="token punctuation">,</span> tx<span class="token punctuation">.</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> receipt <span class="token operator">=</span> <span class="token keyword">await</span> tx<span class="token punctuation">.</span><span class="token function">waitFinalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Transaction included in block </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>receipt<span class="token punctuation">.</span>blockNumber<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Get proof that the message was sent to L1</span>
  <span class="token keyword">const</span> msgProof <span class="token operator">=</span> <span class="token keyword">await</span> zkSyncProvider<span class="token punctuation">.</span><span class="token function">getMessageProof</span><span class="token punctuation">(</span>receipt<span class="token punctuation">.</span>blockNumber<span class="token punctuation">,</span> wallet<span class="token punctuation">.</span>address<span class="token punctuation">,</span> ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">keccak256</span><span class="token punctuation">(</span>someString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Proof that message was sent to L1 :&gt;&gt; &quot;</span><span class="token punctuation">,</span> msgProof<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="smart-contract-in-l2-that-sends-a-message-to-l1"><a href="#smart-contract-in-l2-that-sends-a-message-to-l1" class="header-anchor">#</a> Smart contract in L2 that sends a message to L1</h4> <p>The following contract sends its address to L1 via the Messenger system contract:</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">//SPDX-License-Identifier: Unlicense</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.0</span><span class="token punctuation">;</span>

<span class="token comment">// Importing interfaces and addresses of the system contracts</span>
<span class="token keyword">import</span> <span class="token string">&quot;@matterlabs/zksync-contracts/l2/system-contracts/Constants.sol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Example</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">sendMessageToL1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">bytes32</span> messageHash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Construct the message directly on the contract</span>
        <span class="token builtin">bytes</span> <span class="token keyword">memory</span> message <span class="token operator">=</span> abi<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        messageHash <span class="token operator">=</span> L1_MESSENGER_CONTRACT<span class="token punctuation">.</span><span class="token function">sendToL1</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="prove-the-inclusion-of-the-message-into-the-l2-block"><a href="#prove-the-inclusion-of-the-message-into-the-l2-block" class="header-anchor">#</a> Prove the inclusion of the message into the L2 block</h2> <p>From the L1 side, the zkSync smart contract provides an interface to prove that the message was sent to L1 and included in a zkSync block.</p> <p>The <code>proveL2MessageInclusion</code> function from the <a href="https://github.com/matter-labs/v2-testnet-contracts/blob/main/l1/contracts/zksync/facets/Mailbox.sol" target="_blank" rel="noopener noreferrer">Mailbox L1 contract<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, returns a boolean value that indicates that a message with such parameters, was sent to L1.</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code>
    <span class="token keyword">struct</span> <span class="token class-name">L2Message</span> <span class="token punctuation">{</span>
        <span class="token builtin">address</span> sender<span class="token punctuation">;</span>
        <span class="token builtin">bytes</span> data<span class="token punctuation">;</span>
        <span class="token builtin">uint256</span> txNumberInblock<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">proveL2MessageInclusion</span><span class="token punctuation">(</span>
        <span class="token builtin">uint32</span> _blockNumber<span class="token punctuation">,</span>
        <span class="token builtin">uint256</span> _index<span class="token punctuation">,</span>
        L2Message <span class="token keyword">calldata</span> _message<span class="token punctuation">,</span>
        <span class="token builtin">bytes32</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">calldata</span> _proof
    <span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Here is a detailed description of the required parameters:</p> <ul><li><code>_blockNumber</code> is the l1 batch number in which the l2 block was included. It can be retrieved using the <code>getBlock</code> method.</li> <li><code>_index</code> is the index of the L2 log in the block. It's returned as <code>id</code> by the <code>getMessageProof</code> method of the <code>zksync-web3</code> API.</li> <li><code>_message</code> is a parameter that contains the full information of the message sent. It should be an object containing:
<ul><li><code>sender</code>: the address that sent the message from L2.</li> <li><code>data</code>: the message sent in bytes.</li> <li><code>txNumberInBlock</code>: the index of the transaction in the L2 block, which is returned as <code>transactionIndex</code> using <code>getTransaction</code></li></ul></li> <li><code>_proof</code> is a parameter that contains the Merkle proof of the message inclusion. It can be retrieved either from observing Ethereum or received from the <code>getMessageProof</code> method of the <code>zksync-web3</code> API.</li></ul> <div class="custom-block tip"><p class="custom-block-title">Important</p> <p>Note that the L2 block of your transaction must be verified (and hence the transaction finalized) before prooving the inclusion in L1.</p></div> <h3 id="example"><a href="#example" class="header-anchor">#</a> Example</h3> <h4 id="l1-message-processing-contract"><a href="#l1-message-processing-contract" class="header-anchor">#</a> L1 message processing contract</h4> <p>The following contract receives the information of the transaction sent to the L2 messenger contract and proves that it was included in an L2 block.</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">//SPDX-License-Identifier: Unlicense</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.0</span><span class="token punctuation">;</span>

<span class="token comment">// Importing zkSync contract interface</span>
<span class="token keyword">import</span> <span class="token string">&quot;@matterlabs/zksync-contracts/l1/contracts/zksync/interfaces/IZkSync.sol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Example</span> <span class="token punctuation">{</span>
  <span class="token comment">// NOTE: The zkSync contract implements only the functionality for proving that a message belongs to a block</span>
  <span class="token comment">// but does not guarantee that such a proof was used only once. That's why a contract that uses L2 -&gt; L1</span>
  <span class="token comment">// communication must take care of the double handling of the message.</span>
  <span class="token comment">/// @dev mapping L2 block number =&gt; message number =&gt; flag</span>
  <span class="token comment">/// @dev Used to indicated that zkSync L2 -&gt; L1 message was already processed</span>
  <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">uint32</span> <span class="token operator">=&gt;</span> <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> <span class="token operator">=&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">)</span><span class="token punctuation">)</span> isL2ToL1MessageProcessed<span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">consumeMessageFromL2</span><span class="token punctuation">(</span>
  <span class="token comment">// The address of the zkSync smart contract.</span>
  <span class="token comment">// It is not recommended to hardcode it during the alpha testnet as regenesis may happen.</span>
    <span class="token builtin">address</span> _zkSyncAddress<span class="token punctuation">,</span>
  <span class="token comment">// zkSync block number in which the message was sent</span>
    <span class="token builtin">uint32</span> _l2BlockNumber<span class="token punctuation">,</span>
  <span class="token comment">// Message index, that can be received via API</span>
    <span class="token builtin">uint256</span> _index<span class="token punctuation">,</span>
  <span class="token comment">// The message that was sent from l2</span>
    <span class="token builtin">bytes</span> <span class="token keyword">calldata</span> _message<span class="token punctuation">,</span>
  <span class="token comment">// Merkle proof for the message</span>
    <span class="token builtin">bytes32</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">calldata</span> _proof
  <span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bytes32</span> messageHash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// check that the message has not been processed yet</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isL2ToL1MessageProcessed</span><span class="token punctuation">(</span>_l2BlockNumber<span class="token punctuation">,</span> _index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    IZkSync zksync <span class="token operator">=</span> <span class="token function">IZkSync</span><span class="token punctuation">(</span>_zkSyncAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">address</span> someSender <span class="token operator">=</span> <span class="token number">0x19a5bfcbe15f98aa073b9f81b58466521479df8d</span><span class="token punctuation">;</span>
    L2Message message <span class="token operator">=</span> <span class="token function">L2Message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>sender<span class="token punctuation">:</span> someSender<span class="token punctuation">,</span> data<span class="token punctuation">:</span> _message<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token builtin">bool</span> success <span class="token operator">=</span> zksync<span class="token punctuation">.</span><span class="token function">proveL2MessageInclusion</span><span class="token punctuation">(</span>
      _l2BlockNumber<span class="token punctuation">,</span>
      _index<span class="token punctuation">,</span>
      message<span class="token punctuation">,</span>
      _proof
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>success<span class="token punctuation">,</span> <span class="token string">&quot;Failed to prove message inclusion&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Mark message as processed</span>
    <span class="token function">isL2ToL1MessageProcessed</span><span class="token punctuation">(</span>_l2BlockNumber<span class="token punctuation">,</span> _index<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="end-to-end"><a href="#end-to-end" class="header-anchor">#</a> End to end</h4> <p>The following script sends a message from L2 to L1, retrieves the message proof, and validates that the message received in L1 came from an L2 block.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ethers <span class="token keyword">from</span> <span class="token string">&quot;ethers&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider<span class="token punctuation">,</span> utils<span class="token punctuation">,</span> Wallet <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;zksync-web3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">SENDER_ADDRESS</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;YOUR_ADDRESS&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">TEST_PRIVATE_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;YOUR_PRIVATE_KEY&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">MESSAGE</span> <span class="token operator">=</span> <span class="token string">&quot;Some L2-&gt;L1 message&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> l2Provider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Provider</span><span class="token punctuation">(</span><span class="token string">&quot;https://zksync2-testnet.zksync.dev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> l1Provider <span class="token operator">=</span> ethers<span class="token punctuation">.</span><span class="token function">getDefaultProvider</span><span class="token punctuation">(</span><span class="token string">&quot;goerli&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">sendMessageToL1</span><span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Sending message to L1 with text </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> textBytes <span class="token operator">=</span> ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">toUtf8Bytes</span><span class="token punctuation">(</span><span class="token constant">MESSAGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> wallet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Wallet</span><span class="token punctuation">(</span><span class="token constant">TEST_PRIVATE_KEY</span><span class="token punctuation">,</span> l2Provider<span class="token punctuation">,</span> l1Provider<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> messengerContract <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ethers</span><span class="token punctuation">.</span><span class="token function">Contract</span><span class="token punctuation">(</span>utils<span class="token punctuation">.</span><span class="token constant">L1_MESSENGER_ADDRESS</span><span class="token punctuation">,</span> utils<span class="token punctuation">.</span><span class="token constant">L1_MESSENGER</span><span class="token punctuation">,</span> wallet<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> tx <span class="token operator">=</span> <span class="token keyword">await</span> messengerContract<span class="token punctuation">.</span><span class="token function">sendToL1</span><span class="token punctuation">(</span>textBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> tx<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;L2 trx hash is &quot;</span><span class="token punctuation">,</span> tx<span class="token punctuation">.</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> tx<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getL2MessageProof</span><span class="token punctuation">(</span>blockNumber<span class="token operator">:</span> ethers<span class="token punctuation">.</span>BigNumberish<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Getting L2 message proof for block </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>blockNumber<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">await</span> l2Provider<span class="token punctuation">.</span><span class="token function">getMessageProof</span><span class="token punctuation">(</span>blockNumber<span class="token punctuation">,</span> <span class="token constant">SENDER_ADDRESS</span><span class="token punctuation">,</span> ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">keccak256</span><span class="token punctuation">(</span>ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">toUtf8Bytes</span><span class="token punctuation">(</span><span class="token constant">MESSAGE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">proveL2MessageInclusion</span><span class="token punctuation">(</span>l1BatchNumber<span class="token operator">:</span> ethers<span class="token punctuation">.</span>BigNumberish<span class="token punctuation">,</span> proof<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> trxIndex<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> zkAddress <span class="token operator">=</span> <span class="token keyword">await</span> l2Provider<span class="token punctuation">.</span><span class="token function">getMainContractAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> mailboxL1Contract <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ethers</span><span class="token punctuation">.</span><span class="token function">Contract</span><span class="token punctuation">(</span>zkAddress<span class="token punctuation">,</span> utils<span class="token punctuation">.</span><span class="token constant">ZKSYNC_MAIN_ABI</span><span class="token punctuation">,</span> l1Provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// all the information of the message sent from L2</span>
  <span class="token keyword">const</span> messageInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
    txNumberInBlock<span class="token operator">:</span> trxIndex<span class="token punctuation">,</span>
    sender<span class="token operator">:</span> <span class="token constant">SENDER_ADDRESS</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">toUtf8Bytes</span><span class="token punctuation">(</span><span class="token constant">MESSAGE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Retrieving proof for batch </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>l1BatchNumber<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, transaction index </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>trxIndex<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> and proof id </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>proof<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> mailboxL1Contract<span class="token punctuation">.</span><span class="token function">proveL2MessageInclusion</span><span class="token punctuation">(</span>l1BatchNumber<span class="token punctuation">,</span> proof<span class="token punctuation">.</span>id<span class="token punctuation">,</span> messageInfo<span class="token punctuation">,</span> proof<span class="token punctuation">.</span>proof<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Full end-to-end of an L2-L1 messaging with proof validation.
 * Recommended to run in 3 steps:
 * 1. Send message.
 * 2. Wait for transaction to finalize and block verified
 * 3. Wait for block to be verified and validate proof
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Step 1: send message</span>
  <span class="token keyword">const</span> l2Trx <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendMessageToL1</span><span class="token punctuation">(</span><span class="token constant">MESSAGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Waiting for transaction to finalize...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Step 2: waiting to finalize can take a few minutes.</span>
  <span class="token keyword">const</span> l2Receipt <span class="token operator">=</span> <span class="token keyword">await</span> l2Trx<span class="token punctuation">.</span><span class="token function">waitFinalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Step 3: get and validate proof (block must be verified)</span>
  <span class="token keyword">const</span> proof <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getL2MessageProof</span><span class="token punctuation">(</span>l2Receipt<span class="token punctuation">.</span>blockNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Proof is: </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> proof<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> trx <span class="token operator">=</span> <span class="token keyword">await</span> l2Provider<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span>l2Receipt<span class="token punctuation">.</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// @ts-ignore</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;trx.transactionIndex :&gt;&gt; &quot;</span><span class="token punctuation">,</span> trx<span class="token punctuation">.</span>transactionIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// @ts-ignore</span>
  <span class="token keyword">const</span> block <span class="token operator">=</span> <span class="token keyword">await</span> l2Provider<span class="token punctuation">.</span><span class="token function">getBlock</span><span class="token punctuation">(</span>trx<span class="token punctuation">.</span>blockNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;L1 Batch for block :&gt;&gt; &quot;</span><span class="token punctuation">,</span> block<span class="token punctuation">.</span>l1BatchNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// IMPORTANT: This method requires that the block is verified</span>
  <span class="token comment">// and sent to L1!</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">proveL2MessageInclusion</span><span class="token punctuation">(</span>
    block<span class="token punctuation">.</span>l1BatchNumber<span class="token punctuation">,</span>
    proof<span class="token punctuation">,</span>
    <span class="token comment">// @ts-ignore</span>
    trx<span class="token punctuation">.</span>transactionIndex
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Result is :&gt;&gt; &quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/matter-labs/zksync-web-v2-docs/edit/main/docs/dev/developer-guides/bridging/l2-l1.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/28/2022, 5:37:06 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/dev/developer-guides/bridging/l1-l2.html" class="prev">
        L1 -&gt; L2 communication
      </a></span> <span class="next"><a href="/dev/developer-guides/hello-world.html">
        Quickstart
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.7b8ca578.js" defer></script><script src="/assets/js/2.5a73362d.js" defer></script><script src="/assets/js/49.2a6881e2.js" defer></script>
  </body>
</html>
