<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Building custom paymaster | zkSync — Accelerating the mass adoption of crypto for personal sovereignty</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="/__/firebase/7.13.2/firebase-app.js" defer="true"></script>
    <script src="/__/firebase/7.13.2/firebase-analytics.js" defer="true"></script>
    <script src="/__/firebase/init.js" defer="true"></script>
    <script>
  const logoUrlChanger = setInterval(function() {
    //Anchor above the logo image
    const homeEls = document.getElementsByClassName("home-link");
    if(homeEls.length > 0) {
      const homeEl = homeEls[0];
      homeEl.setAttribute("href", "https://zksync.io");
      homeEl.setAttribute("onclick", "document.location='https://zksync.io';return false;");
      clearInterval(logoUrlChanger);
    }

    //Actual logo image
    const logoEls = document.getElementsByClassName("logo")
    if(logoEls.length > 0) {
      const logoEl = logoEls[0]
      logoEl.setAttribute("onclick", "document.location='https://zksync.io';return false;");
      clearInterval(logoUrlChanger);
    }
  }, 1000)</script>
    <meta name="description" content="zkSync is a ZK rollup that represents the end-game for scaling Ethereum - one that scales its technology and values without degrading security or decentralization">
    
    <link rel="preload" href="/assets/css/0.styles.350a0b01.css" as="style"><link rel="preload" href="/assets/js/app.43917907.js" as="script"><link rel="preload" href="/assets/js/2.b99b9aa7.js" as="script"><link rel="preload" href="/assets/js/74.32c417d0.js" as="script"><link rel="prefetch" href="/assets/js/10.1d31b665.js"><link rel="prefetch" href="/assets/js/11.b268b3af.js"><link rel="prefetch" href="/assets/js/12.1f0cd004.js"><link rel="prefetch" href="/assets/js/13.e8e247c1.js"><link rel="prefetch" href="/assets/js/14.0c7cfd9a.js"><link rel="prefetch" href="/assets/js/15.94b050a9.js"><link rel="prefetch" href="/assets/js/16.e6a47b37.js"><link rel="prefetch" href="/assets/js/17.bd98224d.js"><link rel="prefetch" href="/assets/js/18.23b03e52.js"><link rel="prefetch" href="/assets/js/19.25249c92.js"><link rel="prefetch" href="/assets/js/20.2dded543.js"><link rel="prefetch" href="/assets/js/21.fb191a53.js"><link rel="prefetch" href="/assets/js/22.a420b171.js"><link rel="prefetch" href="/assets/js/23.5f0d4d48.js"><link rel="prefetch" href="/assets/js/24.818c5088.js"><link rel="prefetch" href="/assets/js/25.32e18cd1.js"><link rel="prefetch" href="/assets/js/26.60c607be.js"><link rel="prefetch" href="/assets/js/27.5f9274ea.js"><link rel="prefetch" href="/assets/js/28.96f99bb5.js"><link rel="prefetch" href="/assets/js/29.4de36988.js"><link rel="prefetch" href="/assets/js/3.ed255a8a.js"><link rel="prefetch" href="/assets/js/30.85d3bf0e.js"><link rel="prefetch" href="/assets/js/31.ed6d1d5e.js"><link rel="prefetch" href="/assets/js/32.87ab6f87.js"><link rel="prefetch" href="/assets/js/33.ce141b46.js"><link rel="prefetch" href="/assets/js/34.9f2d876f.js"><link rel="prefetch" href="/assets/js/35.29a9c1ad.js"><link rel="prefetch" href="/assets/js/36.2da22722.js"><link rel="prefetch" href="/assets/js/37.0682c26e.js"><link rel="prefetch" href="/assets/js/38.16d96427.js"><link rel="prefetch" href="/assets/js/39.75916700.js"><link rel="prefetch" href="/assets/js/4.b4b311da.js"><link rel="prefetch" href="/assets/js/40.9a130885.js"><link rel="prefetch" href="/assets/js/41.ce38f5e4.js"><link rel="prefetch" href="/assets/js/42.c7a15e4d.js"><link rel="prefetch" href="/assets/js/43.7834cbc1.js"><link rel="prefetch" href="/assets/js/44.6e1a6fcc.js"><link rel="prefetch" href="/assets/js/45.b2282fdb.js"><link rel="prefetch" href="/assets/js/46.c8b51949.js"><link rel="prefetch" href="/assets/js/47.2c07aaec.js"><link rel="prefetch" href="/assets/js/48.5a3734c4.js"><link rel="prefetch" href="/assets/js/49.c8407e2d.js"><link rel="prefetch" href="/assets/js/5.8c7caf1b.js"><link rel="prefetch" href="/assets/js/50.83537251.js"><link rel="prefetch" href="/assets/js/51.f2b013a0.js"><link rel="prefetch" href="/assets/js/52.1e097047.js"><link rel="prefetch" href="/assets/js/53.70102f1d.js"><link rel="prefetch" href="/assets/js/54.9d27e80f.js"><link rel="prefetch" href="/assets/js/55.e6743c5a.js"><link rel="prefetch" href="/assets/js/56.ea022ccd.js"><link rel="prefetch" href="/assets/js/57.940e83ac.js"><link rel="prefetch" href="/assets/js/58.35f73dba.js"><link rel="prefetch" href="/assets/js/59.8ad42a80.js"><link rel="prefetch" href="/assets/js/6.7c0612a4.js"><link rel="prefetch" href="/assets/js/60.77f33987.js"><link rel="prefetch" href="/assets/js/61.5f78a27b.js"><link rel="prefetch" href="/assets/js/62.2de7f05e.js"><link rel="prefetch" href="/assets/js/63.e44719a8.js"><link rel="prefetch" href="/assets/js/64.251ed610.js"><link rel="prefetch" href="/assets/js/65.3d4a291b.js"><link rel="prefetch" href="/assets/js/66.87c9e577.js"><link rel="prefetch" href="/assets/js/67.3c815a55.js"><link rel="prefetch" href="/assets/js/68.88efe7ab.js"><link rel="prefetch" href="/assets/js/69.8275e1f5.js"><link rel="prefetch" href="/assets/js/7.9cb55bb9.js"><link rel="prefetch" href="/assets/js/70.d449182f.js"><link rel="prefetch" href="/assets/js/71.db493a22.js"><link rel="prefetch" href="/assets/js/72.237d5480.js"><link rel="prefetch" href="/assets/js/73.367496ca.js"><link rel="prefetch" href="/assets/js/75.cff6aa61.js"><link rel="prefetch" href="/assets/js/76.b6732dd4.js"><link rel="prefetch" href="/assets/js/8.f9eaafb5.js"><link rel="prefetch" href="/assets/js/9.2e9fb4a6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.350a0b01.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/LogotypeLight.svg" alt="zkSync — Accelerating the mass adoption of crypto for personal sovereignty" class="logo"> <span class="site-name can-hide">zkSync — Accelerating the mass adoption of crypto for personal sovereignty</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/dev/" class="nav-link router-link-active">
  开发文档
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  工具/SDK
</a></div><div class="nav-item"><a href="/contact.html" class="nav-link">
  联系我们
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="v2.0" class="dropdown-title"><span class="title">v2.0</span> <span class="arrow down"></span></button> <button type="button" aria-label="v2.0" class="mobile-dropdown-title"><span class="title">v2.0</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dev/" class="nav-link router-link-active">
  v2.0
</a></li><li class="dropdown-item"><!----> <a href="https://docs.zksync.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  v1.x
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/matter-labs/zksync-web-v2-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/dev/" class="nav-link router-link-active">
  开发文档
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  工具/SDK
</a></div><div class="nav-item"><a href="/contact.html" class="nav-link">
  联系我们
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="v2.0" class="dropdown-title"><span class="title">v2.0</span> <span class="arrow down"></span></button> <button type="button" aria-label="v2.0" class="mobile-dropdown-title"><span class="title">v2.0</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dev/" class="nav-link router-link-active">
  v2.0
</a></li><li class="dropdown-item"><!----> <a href="https://docs.zksync.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  v1.x
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/matter-labs/zksync-web-v2-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/dev/" aria-current="page" class="sidebar-link">介绍</a></li><li><section class="sidebar-group depth-0"><a href="/dev/fundamentals" class="sidebar-heading clickable"><span>开始</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/fundamentals/rollups.html" class="sidebar-link">rollups 介绍</a></li><li><a href="/dev/fundamentals/zkSync.html" class="sidebar-link">zkSync 基础知识</a></li><li><a href="/dev/fundamentals/testnet.html" class="sidebar-link">zkSync 测试网</a></li><li><a href="/dev/fundamentals/faq.html" class="sidebar-link">FAQ</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/dev/developer-guides" class="sidebar-heading clickable"><span>关于zkSync</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/developer-guides/transactions/transactions.html" class="sidebar-link">Transactions</a></li><li><a href="/dev/developer-guides/transactions/blocks.html" class="sidebar-link">区块</a></li><li><a href="/dev/developer-guides/contracts/system-contracts.html" class="sidebar-link">系统合约</a></li><li><a href="/dev/developer-guides/aa.html" class="sidebar-link">Account abstraction support</a></li><li><a href="/dev/developer-guides/security.html" class="sidebar-link">Security model</a></li><li><a href="/dev/developer-guides/transactions/fee-model.html" class="sidebar-link">Fee mechanism</a></li><li><a href="/dev/developer-guides/bridging/bridging-asset.html" class="sidebar-link">Bridging assets</a></li><li><a href="/dev/developer-guides/bridging/l1-l2-interop.html" class="sidebar-link">L1 / L2 Interoperability</a></li><li><a href="/dev/developer-guides/bridging/l1-l2.html" class="sidebar-link">L1 -&gt; L2 communication</a></li><li><a href="/dev/developer-guides/bridging/l2-l1.html" class="sidebar-link">L2 -&gt; L1 communication</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/dev/developer-guides/building-on-zksync" class="sidebar-heading clickable"><span>在zkSync上构建</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/developer-guides/hello-world.html" class="sidebar-link">快速入门</a></li><li><a href="/dev/developer-guides/contracts/contracts.html" class="sidebar-link">合约部署</a></li><li><a href="/dev/developer-guides/contracts/contract-verification.html" class="sidebar-link">Verify smart contracts</a></li><li><a href="/dev/developer-guides/building-on-zksync/events.html" class="sidebar-link">Handling events</a></li><li><a href="/dev/developer-guides/building-on-zksync/rpc.html" class="sidebar-link">JSON-RPC API</a></li><li><a href="/dev/developer-guides/building-on-zksync/videos.html" class="sidebar-link">Video resources</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/dev/tutorials" class="sidebar-heading clickable router-link-active open"><span>教程</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/tutorials/cross-chain-tutorial.html" class="sidebar-link">Cross-chain governance</a></li><li><a href="/dev/tutorials/custom-aa-tutorial.html" class="sidebar-link">Account abstraction</a></li><li><a href="/dev/tutorials/custom-paymaster-tutorial.html" aria-current="page" class="active sidebar-link">Building custom paymaster</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev/tutorials/custom-paymaster-tutorial.html#prerequisite" class="sidebar-link">Prerequisite</a></li><li class="sidebar-sub-header"><a href="/dev/tutorials/custom-paymaster-tutorial.html#installing-dependencies" class="sidebar-link">Installing dependencies</a></li><li class="sidebar-sub-header"><a href="/dev/tutorials/custom-paymaster-tutorial.html#design" class="sidebar-link">Design</a></li><li class="sidebar-sub-header"><a href="/dev/tutorials/custom-paymaster-tutorial.html#deploying-an-erc20-contract" class="sidebar-link">Deploying an ERC20 contract</a></li><li class="sidebar-sub-header"><a href="/dev/tutorials/custom-paymaster-tutorial.html#deploying-the-paymaster" class="sidebar-link">Deploying the paymaster</a></li><li class="sidebar-sub-header"><a href="/dev/tutorials/custom-paymaster-tutorial.html#using-the-paymaster" class="sidebar-link">Using the paymaster</a></li><li class="sidebar-sub-header"><a href="/dev/tutorials/custom-paymaster-tutorial.html#common-errors" class="sidebar-link">Common errors</a></li><li class="sidebar-sub-header"><a href="/dev/tutorials/custom-paymaster-tutorial.html#complete-project" class="sidebar-link">Complete project</a></li><li class="sidebar-sub-header"><a href="/dev/tutorials/custom-paymaster-tutorial.html#learn-more" class="sidebar-link">Learn more</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/dev/troubleshooting" class="sidebar-heading clickable"><span>错误排除</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/troubleshooting/important-links.html" class="sidebar-link">重要链接</a></li><li><a href="/dev/troubleshooting/status.html" class="sidebar-link">Feature support status</a></li><li><a href="/dev/troubleshooting/docs-contribution/docs.html" class="sidebar-link">文档贡献指南</a></li><li><a href="/dev/troubleshooting/docs-contribution/community-resources.html" class="sidebar-link">Community resources</a></li><li><a href="/dev/troubleshooting/known-issues.html" class="sidebar-link">Known issues</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="building-custom-paymaster"><a href="#building-custom-paymaster" class="header-anchor">#</a> Building custom paymaster</h1> <p>Let's see how we can use the paymaster feature to build a custom paymaster that allows users to pay fees in our token. In this tutorial we will:</p> <ul><li>Create a paymaster that will assume that a single unit of an ERC20 token is enough to cover any transaction fee.</li> <li>Create the ERC20 token contract and send some tokens to a brand new wallet.</li> <li>Finally we will send a <code>mint</code> transaction from the newly created wallet via the paymaster. Even though the transaction would normally require some ETH to pay for the gas fee, our paymaster will execute the transaction in exchange for 1 unit of the ERC20 token.</li></ul> <h2 id="prerequisite"><a href="#prerequisite" class="header-anchor">#</a> Prerequisite</h2> <p>To better understand this page, we recommend you first read up on <a href="/dev/developer-guides/aa.html">account abstraction design</a> before diving into this tutorial.</p> <p>It is assumed that you are already familiar with deploying smart contracts on zkSync. If not, please refer to the first section of the <a href="/dev/developer-guides/hello-world.html">quickstart tutorial</a>. It is also recommended to read the <a href="/dev/developer-guides/contracts/system-contracts.html">introduction</a> to the system contracts.</p> <h2 id="installing-dependencies"><a href="#installing-dependencies" class="header-anchor">#</a> Installing dependencies</h2> <p>We will use the zkSync hardhat plugin for developing this contract. Firstly, we should install all the dependencies for it:</p> <div class="language- extra-class"><pre class="language-text"><code>mkdir custom-paymaster-tutorial
cd custom-paymaster-tutorial
yarn init -y
yarn add -D typescript ts-node ethers zksync-web3 hardhat @matterlabs/hardhat-zksync-solc @matterlabs/hardhat-zksync-deploy
</code></pre></div><p>Since we are working with zkSync contracts, we also need to install the package with the contracts and its peer dependencies:</p> <div class="language- extra-class"><pre class="language-text"><code>yarn add @matterlabs/zksync-contracts @openzeppelin/contracts @openzeppelin/contracts-upgradeable
</code></pre></div><p>Then create the <code>hardhat.config.ts</code> config file, <code>contracts</code> and <code>deploy</code> folders, like in the <a href="/dev/developer-guides/hello-world.html">quickstart tutorial</a>.</p> <h2 id="design"><a href="#design" class="header-anchor">#</a> Design</h2> <p>Our protocol will be a dummy protocol that allows anyone to swap a certain ERC20 token in exchange for paying fees for the transaction.</p> <p>The skeleton for the paymaster looks the following way:</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// SPDX-License-Identifier: MIT</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.0</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> IPaymaster<span class="token punctuation">,</span> ExecutionResult <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@matterlabs/zksync-contracts/l2/system-contracts/interfaces/IPaymaster.sol'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> IPaymasterFlow <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@matterlabs/zksync-contracts/l2/system-contracts/interfaces/IPaymasterFlow.sol'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> TransactionHelper<span class="token punctuation">,</span> Transaction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@matterlabs/zksync-contracts/l2/system-contracts/TransactionHelper.sol'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'@matterlabs/zksync-contracts/l2/system-contracts/Constants.sol'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;@openzeppelin/contracts/interfaces/IERC20.sol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">MyPaymaster</span> <span class="token keyword">is</span> IPaymaster <span class="token punctuation">{</span>
    <span class="token builtin">uint256</span> <span class="token keyword">constant</span> PRICE_FOR_PAYING_FEES <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token builtin">address</span> <span class="token keyword">public</span> allowedToken<span class="token punctuation">;</span>

    <span class="token keyword">modifier</span> <span class="token function">onlyBootloader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> BOOTLOADER_FORMAL_ADDRESS<span class="token punctuation">,</span> <span class="token string">&quot;Only bootloader can call this method&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Continure execution if called from the bootloader.</span>
        <span class="token keyword">_</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">address</span> _erc20<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        allowedToken <span class="token operator">=</span> _erc20<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">validateAndPayForPaymasterTransaction</span><span class="token punctuation">(</span><span class="token builtin">bytes32</span><span class="token punctuation">,</span> <span class="token builtin">bytes32</span><span class="token punctuation">,</span> Transaction <span class="token keyword">calldata</span> _transaction<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> override onlyBootloader <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bytes</span> <span class="token keyword">memory</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Transaction validation logic goes here</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">postOp</span><span class="token punctuation">(</span>
        <span class="token builtin">bytes</span> <span class="token keyword">calldata</span> _context<span class="token punctuation">,</span>
        Transaction <span class="token keyword">calldata</span> _transaction<span class="token punctuation">,</span>
        <span class="token builtin">bytes32</span> _txHash<span class="token punctuation">,</span>
        <span class="token builtin">bytes32</span> _suggestedSignedHash<span class="token punctuation">,</span>
        ExecutionResult _txResult<span class="token punctuation">,</span>
        <span class="token builtin">uint256</span> _maxRefundedErgs
    <span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> onlyBootloader <span class="token punctuation">{</span>
        <span class="token comment">// This contract does not support any refunding logic</span>
    <span class="token punctuation">}</span>

    <span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Note, that only the <a href="/dev/developer-guides/contracts/system-contracts.html#bootloader">bootloader</a> should be allowed to call the <code>validateAndPayForPaymasterTransaction</code>/<code>postOp</code> methods. That's why the <code>onlyBootloader</code> modifier is used for them.</p> <h3 id="parsing-the-paymaster-input"><a href="#parsing-the-paymaster-input" class="header-anchor">#</a> Parsing the paymaster input</h3> <p>In this tutorial, we want to charge the user one unit of the <code>allowedToken</code> in exchange for her fees being paid by the contract.</p> <p>The input that the paymaster should receive is encoded in the <code>paymasterInput</code>. As described <a href="/dev/developer-guides/aa.html#built-in-paymaster-flows">in the paymaster documentation</a>, there are some standardized ways to encode user interactions with paymasterInput. To charge the user, we will require that she has provided enough allowance to the paymaster contract. This is what the <code>approvalBased</code> flow can help us with.</p> <p>Firstly, we'll need to check that the <code>paymasterInput</code> was encoded as in the <code>approvalBased</code> flow:</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">require</span><span class="token punctuation">(</span>_transaction<span class="token punctuation">.</span>paymasterInput<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;The standard paymaster input must be at least 4 bytes long&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token builtin">bytes4</span> paymasterInputSelector <span class="token operator">=</span> <span class="token builtin">bytes4</span><span class="token punctuation">(</span>_transaction<span class="token punctuation">.</span>paymasterInput<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>paymasterInputSelector <span class="token operator">==</span> IPaymasterFlow<span class="token punctuation">.</span>approvalBased<span class="token punctuation">.</span>selector<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token builtin">address</span> token<span class="token punctuation">,</span> <span class="token builtin">uint256</span> minAllowance<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> data<span class="token punctuation">)</span> <span class="token operator">=</span> abi<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>_transaction<span class="token punctuation">.</span>paymasterInput<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">,</span> <span class="token builtin">uint256</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">require</span><span class="token punctuation">(</span>token <span class="token operator">==</span> allowedToken<span class="token punctuation">,</span> <span class="token string">&quot;Invalid token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>minAllowance <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;Min allowance too low&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//</span>
    <span class="token comment">// ...</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">revert</span><span class="token punctuation">(</span><span class="token string">&quot;Unsupported paymaster flow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then, we need to check that the user indeed provided enough allowance:</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token builtin">address</span> userAddress <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token builtin">uint160</span><span class="token punctuation">(</span>_transaction<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">address</span> thisAddress <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token builtin">uint256</span> providedAllowance <span class="token operator">=</span> <span class="token function">IERC20</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">allowance</span><span class="token punctuation">(</span>userAddress<span class="token punctuation">,</span> thisAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">require</span><span class="token punctuation">(</span>providedAllowance <span class="token operator">&gt;=</span> PRICE_FOR_PAYING_FEES<span class="token punctuation">,</span> <span class="token string">&quot;The user did not provide enough allowance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Then, we finally transfer the funds to the user in exchange for 1 unit of this token.</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// Note, that while the minimal amount of ETH needed is tx.ergsPrice * tx.ergsLimit,</span>
<span class="token comment">// neither paymaster nor account are allowed to access this context variable.</span>
<span class="token builtin">uint256</span> requiredETH <span class="token operator">=</span> _transaction<span class="token punctuation">.</span>ergsLimit <span class="token operator">*</span> _transaction<span class="token punctuation">.</span>maxFeePerErg<span class="token punctuation">;</span>

<span class="token comment">// Pulling all the tokens from the user</span>
<span class="token function">IERC20</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transferFrom</span><span class="token punctuation">(</span>userAddress<span class="token punctuation">,</span> thisAddress<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// The bootloader never returns any data, so it can safely be ignored here.</span>
<span class="token punctuation">(</span><span class="token builtin">bool</span> success<span class="token punctuation">,</span> <span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">payable</span><span class="token punctuation">(</span>BOOTLOADER_FORMAL_ADDRESS<span class="token punctuation">)</span><span class="token punctuation">.</span>call<span class="token punctuation">{</span>value<span class="token punctuation">:</span> requiredETH<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">require</span><span class="token punctuation">(</span>success<span class="token punctuation">,</span> <span class="token string">&quot;Failed to transfer funds to the bootloader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">You should validate all the requirements first</p> <p>The <a href="/dev/developer-guides/aa.html#paymaster-validation-rules">rules</a> for the paymaster throttling say that the paymaster won't be throttled if the first storage read the value of which differed from the execution on the API was a storage slot that belonged to the user.</p> <p>That is why it is important to verify that the user provided all the allowed prerequisites to the transaction <em>before</em> performing any logic. This is the reason we <em>first</em> check that the user provided enough allowance, and only then do we do <code>transferFrom</code>.</p></div> <h3 id="full-code-of-the-paymaster"><a href="#full-code-of-the-paymaster" class="header-anchor">#</a> Full code of the paymaster</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// SPDX-License-Identifier: MIT</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.0</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> IPaymaster<span class="token punctuation">,</span> ExecutionResult <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@matterlabs/zksync-contracts/l2/system-contracts/interfaces/IPaymaster.sol'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> IPaymasterFlow <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@matterlabs/zksync-contracts/l2/system-contracts/interfaces/IPaymasterFlow.sol'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> TransactionHelper<span class="token punctuation">,</span> Transaction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@matterlabs/zksync-contracts/l2/system-contracts/TransactionHelper.sol'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'@matterlabs/zksync-contracts/l2/system-contracts/Constants.sol'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;@openzeppelin/contracts/interfaces/IERC20.sol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">MyPaymaster</span> <span class="token keyword">is</span> IPaymaster <span class="token punctuation">{</span>
    <span class="token builtin">uint256</span> <span class="token keyword">constant</span> PRICE_FOR_PAYING_FEES <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token builtin">address</span> <span class="token keyword">public</span> allowedToken<span class="token punctuation">;</span>

    <span class="token keyword">modifier</span> <span class="token function">onlyBootloader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> BOOTLOADER_FORMAL_ADDRESS<span class="token punctuation">,</span> <span class="token string">&quot;Only bootloader can call this method&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Continure execution if called from the bootloader.</span>
        <span class="token keyword">_</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">address</span> _erc20<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        allowedToken <span class="token operator">=</span> _erc20<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">validateAndPayForPaymasterTransaction</span><span class="token punctuation">(</span><span class="token builtin">bytes32</span> _txHash<span class="token punctuation">,</span> <span class="token builtin">bytes32</span> _suggestedSignedHash<span class="token punctuation">,</span> Transaction <span class="token keyword">calldata</span> _transaction<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> override onlyBootloader <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bytes</span> <span class="token keyword">memory</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>_transaction<span class="token punctuation">.</span>paymasterInput<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;The standard paymaster input must be at least 4 bytes long&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token builtin">bytes4</span> paymasterInputSelector <span class="token operator">=</span> <span class="token builtin">bytes4</span><span class="token punctuation">(</span>_transaction<span class="token punctuation">.</span>paymasterInput<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>paymasterInputSelector <span class="token operator">==</span> IPaymasterFlow<span class="token punctuation">.</span>approvalBased<span class="token punctuation">.</span>selector<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">(</span><span class="token builtin">address</span> token<span class="token punctuation">,</span> <span class="token builtin">uint256</span> minAllowance<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> data<span class="token punctuation">)</span> <span class="token operator">=</span> abi<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>_transaction<span class="token punctuation">.</span>paymasterInput<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">,</span> <span class="token builtin">uint256</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">require</span><span class="token punctuation">(</span>token <span class="token operator">==</span> allowedToken<span class="token punctuation">,</span> <span class="token string">&quot;Invalid token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">require</span><span class="token punctuation">(</span>minAllowance <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;Min allowance too low&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token builtin">address</span> userAddress <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token builtin">uint160</span><span class="token punctuation">(</span>_transaction<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token builtin">address</span> thisAddress <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token builtin">uint256</span> providedAllowance <span class="token operator">=</span> <span class="token function">IERC20</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">allowance</span><span class="token punctuation">(</span>userAddress<span class="token punctuation">,</span> thisAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">require</span><span class="token punctuation">(</span>providedAllowance <span class="token operator">&gt;=</span> PRICE_FOR_PAYING_FEES<span class="token punctuation">,</span> <span class="token string">&quot;The user did not provide enough allowance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Note, that while the minimal amount of ETH needed is tx.ergsPrice * tx.ergsLimit,</span>
            <span class="token comment">// neither paymaster nor account are allowed to access this context variable.</span>
            <span class="token builtin">uint256</span> requiredETH <span class="token operator">=</span> _transaction<span class="token punctuation">.</span>ergsLimit <span class="token operator">*</span> _transaction<span class="token punctuation">.</span>maxFeePerErg<span class="token punctuation">;</span>

            <span class="token comment">// Pulling all the tokens from the user</span>
            <span class="token function">IERC20</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transferFrom</span><span class="token punctuation">(</span>userAddress<span class="token punctuation">,</span> thisAddress<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// The bootloader never returns any data, so it can safely be ignored here.</span>
            <span class="token punctuation">(</span><span class="token builtin">bool</span> success<span class="token punctuation">,</span> <span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">payable</span><span class="token punctuation">(</span>BOOTLOADER_FORMAL_ADDRESS<span class="token punctuation">)</span><span class="token punctuation">.</span>call<span class="token punctuation">{</span>value<span class="token punctuation">:</span> requiredETH<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">require</span><span class="token punctuation">(</span>success<span class="token punctuation">,</span> <span class="token string">&quot;Failed to transfer funds to the bootloader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">revert</span><span class="token punctuation">(</span><span class="token string">&quot;Unsupported paymaster flow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">postOp</span><span class="token punctuation">(</span>
        <span class="token builtin">bytes</span> <span class="token keyword">calldata</span> _context<span class="token punctuation">,</span>
        Transaction <span class="token keyword">calldata</span> _transaction<span class="token punctuation">,</span>
        <span class="token builtin">bytes32</span> _txHash<span class="token punctuation">,</span>
        <span class="token builtin">bytes32</span> _suggestedSignedHash<span class="token punctuation">,</span>
        ExecutionResult _txResult<span class="token punctuation">,</span>
        <span class="token builtin">uint256</span> _maxRefundedErgs
    <span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> onlyBootloader <span class="token punctuation">{</span>
        <span class="token comment">// This contract does not support any refunding logic</span>
    <span class="token punctuation">}</span>

    <span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="deploying-an-erc20-contract"><a href="#deploying-an-erc20-contract" class="header-anchor">#</a> Deploying an ERC20 contract</h2> <p>To test our paymaster, we need an ERC20 token. We are now going to deploy one. For the sake of simplicity we will use a somewhat modified OpenZeppelin implementation of it:</p> <p>Create the <code>MyERC20.sol</code> file and put the following code in it:</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// SPDX-License-Identifier: UNLICENSED</span>

<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.0</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;@openzeppelin/contracts/token/ERC20/ERC20.sol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">MyERC20</span> <span class="token keyword">is</span> ERC20 <span class="token punctuation">{</span>
    <span class="token builtin">uint8</span> <span class="token keyword">private</span> _decimals<span class="token punctuation">;</span>

    <span class="token keyword">constructor</span><span class="token punctuation">(</span>
        <span class="token builtin">string</span> <span class="token keyword">memory</span> name_<span class="token punctuation">,</span>
        <span class="token builtin">string</span> <span class="token keyword">memory</span> symbol_<span class="token punctuation">,</span>
        <span class="token builtin">uint8</span> decimals_
    <span class="token punctuation">)</span> <span class="token function">ERC20</span><span class="token punctuation">(</span>name_<span class="token punctuation">,</span> symbol_<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _decimals <span class="token operator">=</span> decimals_<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">mint</span><span class="token punctuation">(</span><span class="token builtin">address</span> _to<span class="token punctuation">,</span> <span class="token builtin">uint256</span> _amount<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">_mint</span><span class="token punctuation">(</span>_to<span class="token punctuation">,</span> _amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">decimals</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> override <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _decimals<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="deploying-the-paymaster"><a href="#deploying-the-paymaster" class="header-anchor">#</a> Deploying the paymaster</h2> <p>To deploy the ERC20 token and the paymaster, we need to create a deployment script. Create the <code>deploy</code> folder and create one file there: <code>deploy-paymaster.ts</code>. Put the following deployment script there:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> utils<span class="token punctuation">,</span> Wallet <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;zksync-web3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ethers <span class="token keyword">from</span> <span class="token string">&quot;ethers&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HardhatRuntimeEnvironment <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;hardhat/types&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Deployer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@matterlabs/hardhat-zksync-deploy&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>hre<span class="token operator">:</span> HardhatRuntimeEnvironment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// The wallet that will deploy the token and the paymaster</span>
  <span class="token comment">// It is assumed that this wallet already has sufficient funds on zkSync</span>
  <span class="token comment">// ⚠️ Never commit private keys to file tracking history, or your account could be compromised.</span>
  <span class="token keyword">const</span> wallet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Wallet</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;PRIVATE-KEY&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// The wallet that will receive ERC20 tokens</span>
  <span class="token keyword">const</span> emptyWallet <span class="token operator">=</span> Wallet<span class="token punctuation">.</span><span class="token function">createRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Empty wallet's address: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>emptyWallet<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Empty wallet's private key: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>emptyWallet<span class="token punctuation">.</span>privateKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> deployer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Deployer</span><span class="token punctuation">(</span>hre<span class="token punctuation">,</span> wallet<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Deploying the ERC20 token</span>
  <span class="token keyword">const</span> erc20Artifact <span class="token operator">=</span> <span class="token keyword">await</span> deployer<span class="token punctuation">.</span><span class="token function">loadArtifact</span><span class="token punctuation">(</span><span class="token string">&quot;MyERC20&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> erc20 <span class="token operator">=</span> <span class="token keyword">await</span> deployer<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span>erc20Artifact<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;MyToken&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;MyToken&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ERC20 address: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>erc20<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Deploying the paymaster</span>
  <span class="token keyword">const</span> paymasterArtifact <span class="token operator">=</span> <span class="token keyword">await</span> deployer<span class="token punctuation">.</span><span class="token function">loadArtifact</span><span class="token punctuation">(</span><span class="token string">&quot;MyPaymaster&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> paymaster <span class="token operator">=</span> <span class="token keyword">await</span> deployer<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span>paymasterArtifact<span class="token punctuation">,</span> <span class="token punctuation">[</span>erc20<span class="token punctuation">.</span>address<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Paymaster address: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>paymaster<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Supplying paymaster with ETH</span>
  <span class="token keyword">await</span> <span class="token punctuation">(</span>
    <span class="token keyword">await</span> deployer<span class="token punctuation">.</span>zkWallet<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      to<span class="token operator">:</span> paymaster<span class="token punctuation">.</span>address<span class="token punctuation">,</span>
      value<span class="token operator">:</span> ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">parseEther</span><span class="token punctuation">(</span><span class="token string">&quot;0.03&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Supplying the ERC20 tokens to the empty wallet:</span>
  <span class="token keyword">await</span> <span class="token comment">// We will give the empty wallet 3 units of the token:</span>
  <span class="token punctuation">(</span><span class="token keyword">await</span> erc20<span class="token punctuation">.</span><span class="token function">mint</span><span class="token punctuation">(</span>emptyWallet<span class="token punctuation">.</span>address<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Minted 3 tokens for the empty wallet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Done!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Besides deploying the paymaster it also creates an empty wallet and gives some of the <code>MyERC20</code> tokens to it, so that it can use the paymaster.</p> <p>To deploy the ERC20 token and the paymaster, you should compile the contracts and run the script:</p> <div class="language- extra-class"><pre class="language-text"><code>yarn hardhat compile
yarn hardhat deploy-zksync --script deploy-paymaster.ts
</code></pre></div><p>The output should be roughly the following:</p> <div class="language- extra-class"><pre class="language-text"><code>Empty wallet's address: 0xAd155D3069BB3c587E995916B320444056d8191F
Empty wallet's private key: 0x236d735297617cc68f4ec8ceb40b351ca5be9fc585d446fa95dff02354ac04fb
ERC20 address: 0x65C899B5fb8Eb9ae4da51D67E1fc417c7CB7e964
Paymaster address: 0x0a67078A35745947A37A552174aFe724D8180c25
Minted 3 tokens for the empty wallet
Done!
</code></pre></div><p>Note that the addresses and private keys will be different for each run.</p> <h2 id="using-the-paymaster"><a href="#using-the-paymaster" class="header-anchor">#</a> Using the paymaster</h2> <p>Create the <code>use-paymaster.ts</code> script in the <code>deploy</code> folder. You can see the example for interacting with the paymaster in the code snippet below:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Provider<span class="token punctuation">,</span> utils<span class="token punctuation">,</span> Wallet <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;zksync-web3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ethers <span class="token keyword">from</span> <span class="token string">&quot;ethers&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HardhatRuntimeEnvironment <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;hardhat/types&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Put the address of the deployed paymaster here</span>
<span class="token keyword">const</span> <span class="token constant">PAYMASTER_ADDRESS</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;PAYMASTER_ADDRESS&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Put the address of the ERC20 token here:</span>
<span class="token keyword">const</span> <span class="token constant">TOKEN_ADDRESS</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;TOKEN_ADDRESS&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Wallet private key</span>
<span class="token comment">// ⚠️ Never commit private keys to file tracking history, or your account could be compromised.</span>
<span class="token keyword">const</span> <span class="token constant">EMPTY_WALLET_PRIVATE_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;EMPTY_WALLET_PRIVATE_KEY&gt;&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getToken</span><span class="token punctuation">(</span>hre<span class="token operator">:</span> HardhatRuntimeEnvironment<span class="token punctuation">,</span> wallet<span class="token operator">:</span> Wallet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> artifact <span class="token operator">=</span> hre<span class="token punctuation">.</span>artifacts<span class="token punctuation">.</span><span class="token function">readArtifactSync</span><span class="token punctuation">(</span><span class="token string">&quot;MyERC20&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ethers</span><span class="token punctuation">.</span><span class="token function">Contract</span><span class="token punctuation">(</span><span class="token constant">TOKEN_ADDRESS</span><span class="token punctuation">,</span> artifact<span class="token punctuation">.</span>abi<span class="token punctuation">,</span> wallet<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>hre<span class="token operator">:</span> HardhatRuntimeEnvironment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> provider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Provider</span><span class="token punctuation">(</span>hre<span class="token punctuation">.</span>config<span class="token punctuation">.</span>zkSyncDeploy<span class="token punctuation">.</span>zkSyncNetwork<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> emptyWallet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Wallet</span><span class="token punctuation">(</span><span class="token constant">EMPTY_WALLET_PRIVATE_KEY</span><span class="token punctuation">,</span> provider<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Obviously this step is not required, but it is here purely to demonstrate that indeed the wallet has no ether.</span>
  <span class="token keyword">const</span> ethBalance <span class="token operator">=</span> <span class="token keyword">await</span> emptyWallet<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ethBalance<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;The wallet is not empty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Balance of the user before mint: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">await</span> emptyWallet<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token constant">TOKEN_ADDRESS</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> erc20 <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span>hre<span class="token punctuation">,</span> emptyWallet<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> gasPrice <span class="token operator">=</span> <span class="token keyword">await</span> provider<span class="token punctuation">.</span><span class="token function">getGasPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Estimate gas fee for mint transaction</span>
  <span class="token keyword">const</span> gasLimit <span class="token operator">=</span> <span class="token keyword">await</span> erc20<span class="token punctuation">.</span>estimateGas<span class="token punctuation">.</span><span class="token function">mint</span><span class="token punctuation">(</span>emptyWallet<span class="token punctuation">.</span>address<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    customData<span class="token operator">:</span> <span class="token punctuation">{</span>
      ergsPerPubdata<span class="token operator">:</span> utils<span class="token punctuation">.</span><span class="token constant">DEFAULT_ERGS_PER_PUBDATA_LIMIT</span><span class="token punctuation">,</span>
      paymasterParams<span class="token operator">:</span> <span class="token punctuation">{</span>
        paymaster<span class="token operator">:</span> <span class="token constant">PAYMASTER_ADDRESS</span><span class="token punctuation">,</span>
        <span class="token comment">// empty input as our paymaster doesn't require additional data</span>
        paymasterInput<span class="token operator">:</span> <span class="token string">&quot;0x&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> fee <span class="token operator">=</span> gasPrice<span class="token punctuation">.</span><span class="token function">mul</span><span class="token punctuation">(</span>gasLimit<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Encoding the &quot;ApprovalBased&quot; paymaster flow's input</span>
  <span class="token keyword">const</span> paymasterParams <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">getPaymasterParams</span><span class="token punctuation">(</span><span class="token constant">PAYMASTER_ADDRESS</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&quot;ApprovalBased&quot;</span><span class="token punctuation">,</span>
    token<span class="token operator">:</span> <span class="token constant">TOKEN_ADDRESS</span><span class="token punctuation">,</span>
    <span class="token comment">// set minimalAllowance as we defined in the paymaster contract</span>
    minimalAllowance<span class="token operator">:</span> ethers<span class="token punctuation">.</span>BigNumber<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// empty bytes as testnet paymaster does not use innerInput</span>
    innerInput<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> <span class="token punctuation">(</span>
    <span class="token keyword">await</span> erc20<span class="token punctuation">.</span><span class="token function">mint</span><span class="token punctuation">(</span>emptyWallet<span class="token punctuation">.</span>address<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment">// Provide gas params manually</span>
      maxFeePerGas<span class="token operator">:</span> gasPrice<span class="token punctuation">,</span>
      maxPriorityFeePerGas<span class="token operator">:</span> gasPrice<span class="token punctuation">,</span>
      gasLimit<span class="token punctuation">,</span>

      <span class="token comment">// paymaster info</span>
      customData<span class="token operator">:</span> <span class="token punctuation">{</span>
        paymasterParams<span class="token punctuation">,</span>
        ergsPerPubdata<span class="token operator">:</span> utils<span class="token punctuation">.</span><span class="token constant">DEFAULT_ERGS_PER_PUBDATA_LIMIT</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Balance of the user after mint: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">await</span> emptyWallet<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token constant">TOKEN_ADDRESS</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>After filling in the parameters <code>PAYMASTER_ADDRESS</code>, <code>TOKEN_ADDRESS</code> and <code>EMPTY_WALLET_PRIVATE_KEY</code> with the output provided in the previous step, run this script with the following command:</p> <div class="language- extra-class"><pre class="language-text"><code>yarn hardhat deploy-zksync --script use-paymaster.ts
</code></pre></div><p>The output should be roughly the following:</p> <div class="language- extra-class"><pre class="language-text"><code>Balance of the user before mint: 3
Balance of the user after mint: 102
</code></pre></div><p>The wallet had 3 tokens after running the deployment script and, after sending the transaction to <code>mint</code> 100 more tokens, the balance is 102 as 1 token was used to pay the transaction fee to the paymaster.</p> <h2 id="common-errors"><a href="#common-errors" class="header-anchor">#</a> Common errors</h2> <p>If the <code>use-paymaster.ts</code> script fails with the error <code>Failed to submit transaction: Failed to validate the transaction. Reason: Validation revert: Paymaster validation error: Failed to transfer funds to the bootloader</code>, please try sending additional ETH to the paymaster so it has enough funds to pay for the transaction. You can use <a href="https://portal.zksync.io/" target="_blank" rel="noopener noreferrer">zkSync Portal<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>If the <code>use-paymaster.ts</code> script fails when minting new ERC20 tokens with the error <code>Error: transaction failed</code>, and the transactions appear with status &quot;Failed&quot; in the <a href="https://explorer.zksync.io/" target="_blank" rel="noopener noreferrer">zkSync explorer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, please reach out to us on <a href="https://discord.com/invite/px2aR7w" target="_blank" rel="noopener noreferrer">our Discord<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> or <a href="https://zksync.io/contact.html" target="_blank" rel="noopener noreferrer">contact page<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. As a workaround, try including a specific <code>gasLimit</code> value in the transaction.</p> <h2 id="complete-project"><a href="#complete-project" class="header-anchor">#</a> Complete project</h2> <p>You can download the complete project <a href="https://github.com/matter-labs/custom-paymaster-tutorial" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="learn-more"><a href="#learn-more" class="header-anchor">#</a> Learn more</h2> <ul><li>To learn more about L1-&gt;L2 interaction on zkSync, check out the <a href="/dev/developer-guides/bridging/l1-l2.html">documentation</a>.</li> <li>To learn more about the <code>zksync-web3</code> SDK, check out its <a href="../../api/js">documentation</a>.</li> <li>To learn more about the zkSync hardhat plugins, check out their <a href="../../api/hardhat">documentation</a>.</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/matter-labs/zksync-web-v2-docs/edit/main/docs/dev/tutorials/custom-paymaster-tutorial.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/17/2022, 9:57:08 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/dev/tutorials/custom-aa-tutorial.html" class="prev">
        Account abstraction
      </a></span> <span class="next"><a href="/dev/troubleshooting/important-links.html">
        重要链接
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.43917907.js" defer></script><script src="/assets/js/2.b99b9aa7.js" defer></script><script src="/assets/js/74.32c417d0.js" defer></script>
  </body>
</html>
