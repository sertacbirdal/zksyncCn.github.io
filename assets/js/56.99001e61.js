(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{491:function(e,t,r){"use strict";r.r(t);var a=r(32),o=Object(a.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"系统合约"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#系统合约"}},[e._v("#")]),e._v(" 系统合约")]),e._v(" "),r("p",[e._v("为了保持零知识电路尽可能简单，并支持简单的扩容，zkSync 的一大部分逻辑被转移到所谓的“系统合约”——一组具有特殊权限和服务于特殊用途的合约。例如，合约的部署，确保用户只为发布合约的 calldata 支付一次费用等。")]),e._v(" "),r("p",[e._v("系统合约的代码在经过全面测试之前不会公开。本节只会为您提供构建 zkSync 所需的知识。")]),e._v(" "),r("h2",{attrs:{id:"接口"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#接口"}},[e._v("#")]),e._v(" 接口")]),e._v(" "),r("p",[e._v("系统合约的地址和接口可以在"),r("a",{attrs:{href:"https://github.com/matter-labs/v2-testnet-contracts/blob/8de367778f3b7ed7e47ee8233c46c7fe046a75a3/l2/system-contracts/Constants.sol",target:"_blank",rel:"noopener noreferrer"}},[e._v("这里"),r("OutboundLink")],1),e._v("找到 。")]),e._v(" "),r("p",[e._v("本节将描述一些最常见的系统合约的语义。")]),e._v(" "),r("h2",{attrs:{id:"contractdeployer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#contractdeployer"}},[e._v("#")]),e._v(" ContractDeployer")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://github.com/matter-labs/v2-testnet-contracts/blob/8de367778f3b7ed7e47ee8233c46c7fe046a75a3/l2/system-contracts/interfaces/IContractDeployer.sol#L5",target:"_blank",rel:"noopener noreferrer"}},[e._v("代码界面"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("该合约用于部署新的智能合约。它的工作是确保每个部署的合约的字节码是已知的。这个合约还定义了衍生地址。每当一个合约被部署，它就会触发 "),r("code",[e._v("ContractDeployed")]),e._v("事件。")]),e._v(" "),r("p",[e._v("未来，我们将添加有关如何直接与此合约进行交互的说明。")]),e._v(" "),r("h2",{attrs:{id:"il1messenger"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#il1messenger"}},[e._v("#")]),e._v(" IL1Messenger")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://github.com/matter-labs/v2-testnet-contracts/blob/8de367778f3b7ed7e47ee8233c46c7fe046a75a3/l2/system-contracts/interfaces/IL1Messenger.sol#L5",target:"_blank",rel:"noopener noreferrer"}},[e._v("代码界面"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("该合约用于将消息从 zkSync 发送到以太坊。对于发送的每条消息，都会触发 "),r("code",[e._v("L1MessageSent")]),e._v(" 事件。")]),e._v(" "),r("h2",{attrs:{id:"inonceholder"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#inonceholder"}},[e._v("#")]),e._v(" INonceHolder")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://github.com/matter-labs/v2-testnet-contracts/blob/8de367778f3b7ed7e47ee8233c46c7fe046a75a3/l2/system-contracts/interfaces/INonceHolder.sol#L5",target:"_blank",rel:"noopener noreferrer"}},[e._v("代码界面"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("该合约存储账户随机数。账户 nonce 存储在一个地方以提高效率("),r("RouterLink",{attrs:{to:"/dev/developer-guides/contracts/contracts.html#differences-in-create-behaviour"}},[e._v("tx nonce 和 deployment nonce")]),e._v(" 存储在同一个地方)并且也为了运营者的方便。")],1),e._v(" "),r("h2",{attrs:{id:"bootloader"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#bootloader"}},[e._v("#")]),e._v(" Bootloader")]),e._v(" "),r("p",[e._v("为了获得更大的可扩容性并降低开销，协议的一些部分(例如账户抽象规则)被转移到名为 "),r("em",[e._v("bootloader")]),e._v(" 的临时合约中。我们称它为临时的，因为它从未正式部署过，也不能被调用，但它有一个正式的"),r("a",{attrs:{href:"https://github.com/matter-labs/v2-testnet-contracts/blob/8de367778f3b7ed7e47ee8233c46c7fe046a75a3/l2/system-contracts/Constants.sol#L19",target:"_blank",rel:"noopener noreferrer"}},[e._v("地址"),r("OutboundLink")],1),e._v("，当它调用其他合约时它会在 "),r("code",[e._v("msg.sender")]),e._v(" 上使用。")]),e._v(" "),r("p",[e._v("现在，您不需要知道关于它的任何细节，但是在使用帐户抽象特性进行开发时，知道它的存在是很重要的。您总是可以假设 bootloader 不是恶意的，并且它是协议的一部分。将来，bootloader 的代码将被公开，对它的任何更改也将意味着对协议的升级。")]),e._v(" "),r("h2",{attrs:{id:"某些系统合约的受保护访问权限"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#某些系统合约的受保护访问权限"}},[e._v("#")]),e._v(" 某些系统合约的受保护访问权限")]),e._v(" "),r("p",[e._v("一些系统合约对账户的影响可能是在以太坊所没有的。例如，在以太坊上，EOA 增加 nonce 的唯一方法是发送交易。同样，发送一个交易每次只能增加 1 nonce。而在 zkSync 上，nonces 是通过 "),r("a",{attrs:{href:"#inonceholder"}},[e._v("NonceHolder")]),e._v(" 系统合约执行的。如果不小心执行，用户可以通过调用这个合约来增加他们的 nonces。这就是为什么对 nonceholder 的大多数非视图方法的调用被限制为只能用一个特殊的 "),r("code",[e._v("isSystem")]),e._v(" 标志来调用，以便与重要的系统合约的交互可以由账户的开发者有意识地管理。")]),e._v(" "),r("p",[e._v("这同样适用于 "),r("a",{attrs:{href:"#contractdeployer"}},[e._v("ContractDeployer")]),e._v(" 系统合约。这意味着您需要明确地允许您的用户部署合约，就像"),r("a",{attrs:{href:"https://github.com/matter-labs/v2-testnet-contracts/blob/3f4b6f906c649671022794ecb5cfc1151c278d93/l2/system-contracts/DefaultAccount.sol#L88",target:"_blank",rel:"noopener noreferrer"}},[e._v("执行 DefaultAccount"),r("OutboundLink")],1),e._v(" 一样。")])])}),[],!1,null,null,null);t.default=o.exports}}]);