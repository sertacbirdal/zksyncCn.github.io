(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{478:function(t,a,s){"use strict";s.r(a);var e=s(32),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"迁移到测试网-paymaster"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#迁移到测试网-paymaster"}},[t._v("#")]),t._v(" 迁移到测试网 paymaster")]),t._v(" "),s("h2",{attrs:{id:"准备工作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[t._v("#")]),t._v(" 准备工作")]),t._v(" "),s("p",[t._v("在进一步进入本节之前，请确保您已阅读"),s("RouterLink",{attrs:{to:"/dev/developer-guides/aa.html#paymasters"}},[t._v("paymasters")]),t._v("。")],1),t._v(" "),s("p",[t._v("虽然之前的 zkSync 2.0 测试网迭代原生支持以不同的代币支付费用，但它导致了与以太坊生态系统的几个兼容性问题。随着 "),s("RouterLink",{attrs:{to:"/dev/developer-guides/aa.html#paymasters"}},[t._v("paymasters")]),t._v(" 的出现，此功能已变得多余，因为现在任何人都可以部署他们的 paymaster 智能合约，将 ERC-20 代币即时交换为 ETH。您可以在 "),s("RouterLink",{attrs:{to:"/dev/tutorials/custom-paymaster-tutorial.html"}},[t._v("此处")]),t._v(" 阅读有关部署自定义 paymaster 的教程。")],1),t._v(" "),s("p",[t._v("为了支持生态系统，zkSync 不打算在主网上部署任何 paymaster。但是，考虑到更好的 DevEx，我们在测试网上部署了一个。 testnet paymaster 能够以 1:1 的汇率使用兼容 ERC-20 的代币支付费用。您可以阅读文档 "),s("RouterLink",{attrs:{to:"/dev/developer-guides/aa.html#testnet-paymaster"}},[t._v("此处")]),t._v("。在本节中，我们将展示一个关于从使用 ERC20 代币支付费用的旧方式迁移到新方式的简短示例。")],1),t._v(" "),s("p",[t._v("本文档是关于 testnet paymaster "),s("em",[t._v("only")]),t._v("。在主网上部署您的项目时，您将需要部署您的 paymaster 或找到第 3 方的付款人并阅读其文档。")]),t._v(" "),s("h2",{attrs:{id:"过去的版本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#过去的版本"}},[t._v("#")]),t._v(" 过去的版本")]),t._v(" "),s("p",[t._v("在之前的测试网版本中，您在交易的覆盖中提供了 "),s("code",[t._v("feeToken")]),t._v("，因此以 USDC 支付费用的智能合约调用大致如下所示：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" tx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" contract"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("callMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("customData")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("feeToken")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("USDC_ADDRESS")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n")])])]),s("h2",{attrs:{id:"使用测试网paymaster"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用测试网paymaster"}},[t._v("#")]),t._v(" 使用测试网paymaster")]),t._v(" "),s("p",[t._v("使用 testnet paymaster 包括三个步骤：")]),t._v(" "),s("ol",[s("li",[t._v("获取测试网 paymaster 的地址。")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" testnetPaymaster "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" provider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTestnetPaymasterAddress")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("注意：不建议缓存paymaster的地址，因为它可能会在没有警告的情况下更改。")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("编码要在交易中使用paymaster参数， 为此，您可以使用"),s("code",[t._v("utils.getPaymasterParams")]),t._v("方法：")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" utils "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'zksync-web3'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" paymasterParams "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" utils"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPaymasterParams")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("testnetPaymaster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ApprovalBased'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("token")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("USDC_ADDRESS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Note, that the allowance for the testnet paymaster must be")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// at least maxFeePerErg * gasLimit, where maxFeePerErg and gasLimit")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// are parameters used in the transaction.")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("minimalAllowance")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" maxFeePerErg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mul")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gasLimit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("innerInput")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Uint8Array")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("使用提供的 paymaster 参数发送交易：")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" tx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" contract"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("callMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("customData")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        paymasterParams\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);